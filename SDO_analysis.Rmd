---
title: " Analisi Schede Dimissioni Ospedaliere "
author: "| Marco Gaudio |"
date: "`r format(Sys.Date(), '%d %B, %Y')`"
output:
  html_document:
    code_folding: show
    highlight: tango
    keep_md: no
    number_sections: yes
    theme: united
    toc: yes
    toc_float: yes
  word_document:
    toc: yes
  pdf_document:
    toc: yes
  github_document:
    toc: yes
---

```{r, include=FALSE}
options(scipen=999)
knitr::opts_chunk$set(echo = TRUE, 
                      include = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      comment = FALSE)
library(tidymodels)
library(tidyverse)
library(palmerpenguins)
library(kableExtra)
library(DT)
library(lemon)
```


The aim of this document is to analyze the datas related to the italian *Schede Dimissioni Ospedaliere* (SDO), in the period 2016 - 2019. 
The data are provided by the [**Italian Ministry of Health**](http://www.salute.gov.it/portale/temi/p2_6.jsp?lingua=italiano&id=1237&area=ricoveriOspedalieri&menu=vuotolink).

The document is composed by 4 sections: 

* **section 1** provides an analysis for each of the 5 activities (Acuti Regime ordinario;       Acuti Regime diurno, Riabilitazione Regime ordinario; Riabilitazione Regime diurno;        Lungodegenza) and considering the differences in the period studied. 

* **section 2** analyses the hospitalization rates, first providing an overview for Italy as a whole, and then analysing the rates for each of the 5 activities in in the period 2016-2019, considering different region, gender and age category.

* **section 3** gives an overview of the Italian and English population in 2019, then an analysis in UK of the total number of surgeries (that can be compared to the total number of the italian *dimissioni*) and surgical incidences (the italian **tasso di ospedalizzazione**) is made. Lastly, It shows a comparison between the overall hospitalization rates in Italy and UK,
thanks to the data provided by thr [**Health and Social Care Information Centre**](https://digital.nhs.uk/), now called NHS Digital. 

* **section 4** proposes an analysis of the data about hospitalization discharges collected from two different sources: Istat and Italian Ministry of Health.
 
 
 Besides, a comparison is made with the data about hospitalization rates in Italy provided by [**istat**](http://dati.istat.it/).


```{r}
# construct a summary table
summary_ordinario <- matching_tables %>% 
  group_by(ANNO) %>%
  summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3)) %>%
  mutate(`ATTIVITÀ` = "Acuti - Regime ordinario")

summary_diurno <- matching_tables_2.2.11 %>% 
  group_by(ANNO) %>%
  summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3)) %>%
  mutate(`ATTIVITÀ` = "Acuti - Regime diurno")

summary_riab_ord <- SDO_ordinario_riab %>%
  group_by(ANNO) %>%
  summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3)) %>%
  mutate(`ATTIVITÀ` = "Riabilitazione - Regime ordinario")

summary_riab_diurno <- SDO_diurno_riab %>%
  group_by(ANNO) %>%
  summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3)) %>%
  mutate(`ATTIVITÀ` = "Riabilitazione - Regime diurno")

summary_lungodegenza <- SDO_lungodegenza %>%
  group_by(ANNO) %>%
  summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3)) %>%
  mutate(`ATTIVITÀ` = "Riabilitazione - Regime diurno")

summary_tab <- dplyr::bind_rows(summary_ordinario,
                                summary_diurno,
                                summary_riab_ord,
                                summary_riab_diurno,
                                summary_lungodegenza)

```


### An overview of hospitalization discharges in Italy {-}
The following graph shows the total number of hospital discharges divided by activity for the 4 years of analysis.

```{r, echo=FALSE, include=TRUE}

  p <- ggplot(summary_tab, aes(x = ANNO, y = DIMISSIONI, fill = `ATTIVITÀ`)) + 
  geom_bar(stat = "identity") +
  labs(title = "DIMISSIONI TOTALI PER ATTIVITÀ",
  subtitle = "Italia",
  caption = "Source: Ministero della Salute")
p
```

Table 1.1.1 shows the total number of discharges for all the activities and its percentage variation through the period of analysis. As shown here, the total number of hospital discharges is decreased from 2016 to 2019. In particular, from 2018 to 2019 the number has dropped from 8.522.456 to 8.356.874, with a decrease of 1.733%.

```{r, echo=FALSE, include=TRUE}

summary_tab %>% 
  dplyr::group_by(ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100,
                                        digits = 3)) %>%
DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 1.1.1')

```



# ATTIVITÀ

## Acuti - Regime ordinario.
the following section is aimed to analyze the discharge in *Acuti - Regime ordinario*, from 2016 to 2019 in Italy.

### DIMISSIONI

Table 1.1.2 provides a summary of the hospedalization discharges in *"Acuti - Regime ordinario"* and the variation from year to year.

```{r, echo=FALSE, include=TRUE}
summary_ordinario <- matching_tables %>% 
  dplyr::group_by(ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3))

summary_ordinario %>% 
  DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 1.1.2')



```

This bar chart shows the hospital discharges by [MDC](#glossario) for each year of the analysis.
```{r, echo=FALSE, include=TRUE}

SDO_ordinario %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = DIMISSIONI,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER MDC",
              subtitle = "Acuti - Regime ordinario",
       caption = "Source: Ministero della Salute") + 
  xlab("CLASSE MDC")

  
```

As shown from the bar chart, over the 4 years of analysis, the MDC class with the greatest number of dicharges for the activity *Acuti - Regime ordinario* is the **MDC 05 - Malattie e disturbi dell'apparato cardiocircolatorio**, followed by **MDC 08 - Malattie e disturbi del sistema muscolo-scheletrico e del tessuto connettivo** and **MDC 04 - Malattie e disturbi dell'apparato respiratorio**.  



The following table provides a summary of the discharges for each MDC class and for each year.

```{r, echo=FALSE, include=TRUE}
#overall discharges for acuti - regime ordinario for the 4 years
overall_ordinario <- matching_tables %>%
  dplyr::select(CLASSE_MDC, DIMISSIONI, ANNO)

overall_ordinario %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.1.3')
```

### PERCENTUALE GIORNI DIMISSIONI PER MDC.

Thwe following pie charts show the percentage of days before discharge per the 4 years analysed.


```{r, echo=FALSE, include=TRUE}

percentage_tab <- function(year){
  perc <- SDO_ordinario %>%
  filter(ANNO == year) %>%
  mutate(percentage_dim1gg = `% DIMISSIONI DI 1 GIORNO`/100,
         percentage_dim2gg = `% DIMISSIONI DI 2-3 GIORNI`/100,
         percentage_dim4gg = `% DIMISSIONI TRA 4 GIORNI E VALORE SOGLIA`/100,
         percentage_dimooltre = `% DIMISSIONI OLTRE VALORE SOGLIA`/100) 
# compute the percentage for the whole MDC

dimissioni <- as.matrix(perc$DIMISSIONI, ncol = 1)  
percent_oneday <-  as.matrix(perc$percentage_dim1gg, nrow = 1) 
percent_twoday <- as.matrix(perc$percentage_dim2gg, nrow = 1)
percent_fourday <- as.matrix(perc$percentage_dim4gg, nrow = 1)
percentbeyond <- as.matrix(perc$percentage_dimooltre, nrow = 1)

dimissioni_1 <- round((t(percent_oneday) %*% dimissioni )/ sum(perc$DIMISSIONI), digits = 3)
dimissioni_2 <- round((t(percent_twoday) %*% dimissioni )/ sum(perc$DIMISSIONI), digits = 3)
dimissioni_4 <- round((t(percent_fourday) %*% dimissioni )/ sum(perc$DIMISSIONI), digits = 3)
dimissioni_oltre <- round((t(percentbeyond) %*% dimissioni )/ sum(perc$DIMISSIONI), 
                          digits = 3)
return(c(dimissioni_1,dimissioni_2, dimissioni_4, dimissioni_oltre))
}
perc <- SDO_ordinario %>%
  filter(ANNO == "2019") %>%
  mutate(percentage_dim1gg = `% DIMISSIONI DI 1 GIORNO`/100,
         percentage_dim2gg = `% DIMISSIONI DI 2-3 GIORNI`/100,
         percentage_dim4gg = `% DIMISSIONI TRA 4 GIORNI E VALORE SOGLIA`/100,
         percentage_dimooltre = `% DIMISSIONI OLTRE VALORE SOGLIA`/100) 
# compute the percentage for the whole MDC

dimissioni <- as.matrix(perc$DIMISSIONI, ncol = 1)  
percent_oneday <-  as.matrix(perc$percentage_dim1gg, nrow = 1) 
percent_twoday <- as.matrix(perc$percentage_dim2gg, nrow = 1)
percent_fourday <- as.matrix(perc$percentage_dim4gg, nrow = 1)
percentbeyond <- as.matrix(perc$percentage_dimooltre, nrow = 1)

dimissioni_1 <- round((t(percent_oneday) %*% dimissioni )/ sum(perc$DIMISSIONI), digits = 3)
dimissioni_2 <- round((t(percent_twoday) %*% dimissioni )/ sum(perc$DIMISSIONI), digits = 3)
dimissioni_4 <- round((t(percent_fourday) %*% dimissioni )/ sum(perc$DIMISSIONI), digits = 3)
dimissioni_oltre <- round((t(percentbeyond) %*% dimissioni )/ sum(perc$DIMISSIONI), 
                          digits = 3)


mycols <- c("% DIMISSIONI DI 1 GIORNO",                 
            "% DIMISSIONI DI 2-3 GIORNI",              
            "% DIMISSIONI TRA 4 GIORNI E VALORE SOGLIA",
            "% DIMISSIONI OLTRE VALORE SOGLIA")

prop_table <- function(year){
  discharges_prop <- percentage_tab(year)
tabella_plot <- tidyr::tibble(class = mycols,
                       proportion = discharges_prop) %>%
  dplyr::arrange(-proportion) %>%
  dplyr::mutate(Per_cumsum = cumsum(proportion)) %>%
  dplyr::mutate(ANNO = year)

}
Years <- c("2016", "2017", "2018", "2019")

summary_list <- purrr::map(Years, prop_table)

summary_prop <- dplyr::bind_rows(summary_list) 

discharges_2019 <- percentage_tab("2019")
tabella_plot_2019 <- tibble(class = mycols,
                       proportion = discharges_2019) %>%
  arrange(-proportion) %>%
  mutate(Per_cumsum = cumsum(proportion))


ggplot(data = summary_prop, aes(x=1, y=proportion, fill=class)) +
  geom_col() +
  geom_text(aes(label = proportion*100), position = position_stack(vjust = 0.5))+
  coord_polar(theta = "y") + 
  theme_void() +
  labs(title = "% DIMISSIONI PER GIORNO",
       subtitle = "Acuti - Regime ordinario",
       fill = "") +
  facet_wrap(~ANNO)



```






The bar chart below shows the distribution of discharges in *Acuti - Regime ordinario* per age category, for each year of analysis.

```{r, echo=FALSE, include=TRUE}

sdo_age_gender2 <- sdo_age_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti - Regime ordinario") %>%
  dplyr::mutate_at(vars(`Categoria età`), factor)

sdo_age_gender2$`Categoria età` <- factor(sdo_age_gender2$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 9 anni",
                                            "Da 10 a 14 anni",
                                            "Da 15 a 19 anni",
                                            "Da 20 a 24 anni",
                                            "Da 25 a 29 anni", 
                                            "Da 30 a 34 anni", 
                                            "Da 35 a 39 anni",
                                            "Da 40 a 44 anni",
                                            "Da 45 a 49 anni", 
                                            "Da 50 a 54 anni", 
                                            "Da 55 a 59 anni", 
                                            "Da 60 a 64 anni", 
                                            "Da 65 a 69 anni", 
                                            "Da 70 a 74 anni",
                                            "75 anni e oltre"))
sdo_age_gender2 %>%
  dplyr::select(`Categoria età`, MASCHI, FEMMINE, ANNO) %>%
  dplyr::mutate(DIMISSIONI_TOT = MASCHI + FEMMINE) %>%
  dplyr::select(`Categoria età`, DIMISSIONI_TOT, ANNO) %>%
 
  ggplot(., aes(x = `Categoria età`,y = DIMISSIONI_TOT, fill = ANNO)) +
  geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER ETÀ",
       subtitle = "Acuti - Regime ordinario",
       caption = "Source: Ministero della Salute"
       ) + 
  ylab("DIMISSIONI") + 
  xlab("CATEGORIA ETÀ")

  
  




```




### GIORNATE DI DEGENZA {.tabset}

The following graph shows the [*Giorni di Degenza*](#glossario) for each MDC and over the years of analysis.
```{r, echo=FALSE, include=TRUE}
SDO_ordinario %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(GIORNI_DEGENZA = sum(`GIORNI DI DEGENZA`)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = GIORNI_DEGENZA,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "GIORNI DI DEGENZA",
              subtitle = "Acuti - Regime ordinario",
       caption = "Source: Ministero della Salute") + 
  ylab("GIORNI DI DEGENZA") + 
  xlab("CLASSE MDC")


```


Table 1.1.4 provides a summary for *Giorni di Degenza* by MDC for each year.

```{r, echo=FALSE, include=TRUE}
overall_ordinario_degenza <- matching_tables %>%
  dplyr::select(CLASSE_MDC, `GIORNATE DI DEGENZA`, ANNO)

overall_ordinario_degenza %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 1.1.4"
                )

```

The following graph shows the Mean value for *Giorni di Degenza* for each MDC.

#### 2019 {-}
```{r, echo=FALSE, include=TRUE}
sum_deg <- SDO_ordinario %>%
  dplyr::filter(ANNO == "2019") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_DEGENZA = max(`Degenza massima`),
            MIN_DEGENZA = min(`Degenza minima`),
            MEAN_DEGENZA = round(mean(`DEGENZA MEDIA (giorni)`), digits = 3))

ggplot(data = sum_deg, mapping = aes(x = forcats::fct_reorder(CLASSE_MDC,
                                                             MEAN_DEGENZA), 
                                     y = MEAN_DEGENZA)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Acuti - Regime ordinario",
       caption = "Source: Ministero della Salute",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  


```

#### 2018 {-}
```{r, echo=FALSE, include=TRUE}

sum_deg <- SDO_ordinario %>%
  dplyr::filter(ANNO == "2018") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_DEGENZA = max(`Degenza massima`),
            MIN_DEGENZA = min(`Degenza minima`),
            MEAN_DEGENZA = round(mean(`DEGENZA MEDIA (giorni)`), digits = 3))

ggplot(data = sum_deg, mapping = aes(x = forcats::fct_reorder(CLASSE_MDC,
                                                             MEAN_DEGENZA), 
                                     y = MEAN_DEGENZA)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Acuti - Regime ordinario",
       caption = "Source: Ministero della Salute",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  


```

#### 2017 {-}
```{r, echo=FALSE, include=TRUE}
sum_deg <- SDO_ordinario %>%
  dplyr::filter(ANNO == "2017") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_DEGENZA = max(`Degenza massima`),
            MIN_DEGENZA = min(`Degenza minima`),
            MEAN_DEGENZA = round(mean(`DEGENZA MEDIA (giorni)`), digits = 3))

ggplot(data = sum_deg, mapping = aes(x = forcats::fct_reorder(CLASSE_MDC,
                                                             MEAN_DEGENZA), 
                                     y = MEAN_DEGENZA)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Acuti - Regime ordinario",
       caption = "Source: Ministero della Salute",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  


```


#### 2016 {-}
```{r, echo=FALSE, include=TRUE}
sum_deg <- SDO_ordinario %>%
  dplyr::filter(ANNO == "2016") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_DEGENZA = max(`Degenza massima`),
            MIN_DEGENZA = min(`Degenza minima`),
            MEAN_DEGENZA = round(mean(`DEGENZA MEDIA (giorni)`), digits = 3))

ggplot(data = sum_deg, mapping = aes(x = forcats::fct_reorder(CLASSE_MDC,
                                                             MEAN_DEGENZA), 
                                     y = MEAN_DEGENZA)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Acuti - Regime ordinario",
       caption = "Source: Ministero della Salute",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  


```

### {-}

Table 1.1.5 provides a summary of Max, Min and Mean values for *"Giorni di Degenza"* for each MDC.
```{r, echo=FALSE, include=TRUE}

SDO_ordinario %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_DEGENZA = max(`Degenza massima`),
            MIN_DEGENZA = min(`Degenza minima`),
            MEAN_DEGENZA = round(mean(`DEGENZA MEDIA (giorni)`), digits = 3)) %>%
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.1.5'
    
  )

```



## Acuti - Regime diurno.

### DIMISSIONI

Table 1.2.1 provides a summary of the hospedalization discharges in *"Acuti - Regime diurno"* and the variation from year to year.


```{r, echo=FALSE, include=TRUE}
summary_diurno <- matching_tables_2.2.11 %>% 
  dplyr::group_by(ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3))

summary_diurno %>% 
  DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 1.2.1')



```


This bar chart shows the hospital discharges by MDC for each year of the analysis.
```{r, echo=FALSE, include=TRUE}

SDO_diurno %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = DIMISSIONI,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER MDC",
              subtitle = "Acuti - Regime diurno",
       caption = "Source: Ministero della Salute") + 
  xlab("CLASSE MDC")

  
```


In the case of *Acuti - Regime diurno*, over the 4 years of analysis, the MDC class with the greatest number of dicharges is the **MDC 08 - Malattie e disturbi del sistema muscolo-scheletrico e del tessuto connettivo**, followed by **MDC 17 - Malattie e disturbi mieloproliferativi e neoplasie scarsamente differenziate** and **MDC 13 -Malattie e disturbi dell'apparato riproduttivo femminile**.  


The following table provides a summary of the discharges for each MDC class and for each year.

```{r, echo=FALSE, include=TRUE}
#overall discharges for acuti - regime diurno for the 4 years
overall_diurno <- matching_tables_2.2.11 %>%
  dplyr::select(CLASSE_MDC, DIMISSIONI, ANNO)

overall_diurno %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.2.2')
```

The bar chart below shows the distribution of discharges in *Acuti - Regime diurno* per age category, for each year of analysis.

```{r, echo=FALSE, include=TRUE}

sdo_age_gender2 <- sdo_age_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti - Regime diurno") %>%
  dplyr::mutate_at(vars(`Categoria età`), factor)

sdo_age_gender2$`Categoria età` <- factor(sdo_age_gender2$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 9 anni",
                                            "Da 10 a 14 anni",
                                            "Da 15 a 19 anni",
                                            "Da 20 a 24 anni",
                                            "Da 25 a 29 anni", 
                                            "Da 30 a 34 anni", 
                                            "Da 35 a 39 anni",
                                            "Da 40 a 44 anni",
                                            "Da 45 a 49 anni", 
                                            "Da 50 a 54 anni", 
                                            "Da 55 a 59 anni", 
                                            "Da 60 a 64 anni", 
                                            "Da 65 a 69 anni", 
                                            "Da 70 a 74 anni",
                                            "75 anni e oltre"))
sdo_age_gender2 %>%
  dplyr::select(`Categoria età`, MASCHI, FEMMINE, ANNO) %>%
  dplyr::mutate(DIMISSIONI_TOT = MASCHI + FEMMINE) %>%
  dplyr::select(`Categoria età`, DIMISSIONI_TOT, ANNO) %>%
 
  ggplot(., aes(x = `Categoria età`,y = DIMISSIONI_TOT, fill = ANNO)) +
  geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER ETÀ",
       subtitle = "Acuti - Regime diurno",
       caption = "Source: Ministero della Salute") + 
  ylab("DIMISSIONI") + 
  xlab("CATEGORIA ETÀ")

  
  




```

### ACCESSI {.tabset}

The following graph shows the [*Accessi*](#glossario) for each MDC and over the years of analysis.
```{r, echo=FALSE, include=TRUE}
SDO_diurno %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(Accessi = sum(Accessi)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = Accessi,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "ACCESSI",
              subtitle = "Acuti - Regime diurno",
       caption = "Source: Ministero della Salute") +
  ylab("ACCESSI") + 
  xlab("CLASSE MDC")


```

These bar charts shows the mean for the variable *Accessi* by each MDC and for the 4 years of analysis.

#### 2019 {-}
```{r, echo=FALSE, include=TRUE}
sum_accessi <- SDO_diurno %>%
  dplyr::filter(ANNO == "2019") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_accessi = max(`N. max. Accessi.`),
            MIN_accessi = min(`N. min. Accessi`),
            MEAN_accessi = round(mean(`N. medio Accessi`), digits = 3))

ggplot(data = sum_accessi, mapping = aes(x =    forcats::fct_reorder(CLASSE_MDC,                                                               MEAN_accessi), 
      y = MEAN_accessi)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER OGNI MDC",
              subtitle = "Acuti - Regime diurno",
       caption = "Source: Ministero della Salute",
       x = "CLASSE MDC",
       y = "ACCESSI") 
  

```


#### 2018 {-}
```{r, echo=FALSE, include=TRUE}
sum_accessi <- SDO_diurno %>%
  dplyr::filter(ANNO == "2018") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_accessi = max(`N. max. Accessi.`),
            MIN_accessi = min(`N. min. Accessi`),
            MEAN_accessi = round(mean(`N. medio Accessi`), digits = 3))

ggplot(data = sum_accessi, mapping = aes(x =    forcats::fct_reorder(CLASSE_MDC,                                                               MEAN_accessi), 
      y = MEAN_accessi)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER OGNI MDC",
              subtitle = "Acuti - Regime diurno",
       caption = "Source: Ministero della Salute",
       x = "CLASSE MDC",
       y = "ACCESSI") 
  

```



#### 2017 {-}
```{r, echo=FALSE, include=TRUE}
sum_accessi <- SDO_diurno %>%
  dplyr::filter(ANNO == "2017") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_accessi = max(`N. max. Accessi.`),
            MIN_accessi = min(`N. min. Accessi`),
            MEAN_accessi = round(mean(`N. medio Accessi`), digits = 3))

ggplot(data = sum_accessi, mapping = aes(x =    forcats::fct_reorder(CLASSE_MDC,                                                               MEAN_accessi), 
      y = MEAN_accessi)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER OGNI MDC",
              subtitle = "Acuti - Regime diurno",
       x = "CLASSE MDC",
       caption = "Source: Ministero della Salute",
       y = "ACCESSI") 
  

```


#### 2016 {-}
```{r, echo=FALSE, include=TRUE}
sum_accessi <- SDO_diurno %>%
  dplyr::filter(ANNO == "2016") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_accessi = max(`N. max. Accessi.`),
            MIN_accessi = min(`N. min. Accessi`),
            MEAN_accessi = round(mean(`N. medio Accessi`), digits = 3))

ggplot(data = sum_accessi, mapping = aes(x =    forcats::fct_reorder(CLASSE_MDC,                                                               MEAN_accessi), 
      y = MEAN_accessi)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER OGNI MDC",
              subtitle = "Acuti - Regime diurno",
       x = "CLASSE MDC",
       caption = "Source: Ministero della Salute",
       y = "ACCESSI") 
  


```




### {-}

Table 1.2.3 provides a summary of Max, Min and Mean values for *"Accessi"* for each MDC.
```{r, echo=FALSE, include=TRUE}

SDO_diurno %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_accessi = max(`N. max. Accessi.`),
            MIN_accessi = min(`N. min. Accessi`),
            MEAN_accessi = round(mean(`N. medio Accessi`), digits = 3)) %>% 
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.2.3'
    
  )
```


## Riabilitazione - Regime ordinario.

### DIMISSIONI

Table 1.3.1 provides a summary of the hospedalization discharges in *"Riabilitazione - Regime ordinario"* and the variation from year to year.

```{r, echo=FALSE, include=TRUE}
summary_ordinario_riab <- SDO_ordinario_riab %>% 
  dplyr::group_by(ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3))

summary_ordinario_riab %>% 
  DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 1.3.1')



```

This bar chart shows the hospital discharges by MDC for each year of the analysis.
```{r, echo=FALSE, include=TRUE}

SDO_ordinario_riab %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = DIMISSIONI,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER MDC",
              subtitle = "Riabilitazione - Regime ordinario",
       caption = "Source: Ministero della Salute") + 
  xlab("CLASSE MDC")

  
```

There are just a few MDC classes with a considerable number of discharges in *Riabilitazione - Regime ordinario*. These are: **MDC 08 - Malattie e disturbi del sistema muscolo-scheletrico e del tessuto connettivo**; **MDC 01 - Malattie e disturbi del sistema nervoso**; **MDC 05 - Malattie e disturbi dell'apparato cardiocircolatorio**.


Table 1.3.2 provides a summary of the discharges for each MDC class and for each year.

```{r, echo=FALSE, include=TRUE}
#overall discharges for acuti - regime diurno for the 4 years
overall_riab_ord <- SDO_ordinario_riab %>%
  dplyr::select(CLASSE_MDC, DIMISSIONI, ANNO)

overall_riab_ord %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.3.2')
```


The bar chart below shows the distribution of discharges in *Riabilitazione - Regime ordinario* per age category, for each year of analysis.

```{r, echo=FALSE, include=TRUE}

sdo_age_gender2 <- sdo_age_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione - Regime ordinario") %>%
  dplyr::mutate_at(vars(`Categoria età`), factor)

sdo_age_gender2$`Categoria età` <- factor(sdo_age_gender2$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 9 anni",
                                            "Da 10 a 14 anni",
                                            "Da 15 a 19 anni",
                                            "Da 20 a 24 anni",
                                            "Da 25 a 29 anni", 
                                            "Da 30 a 34 anni", 
                                            "Da 35 a 39 anni",
                                            "Da 40 a 44 anni",
                                            "Da 45 a 49 anni", 
                                            "Da 50 a 54 anni", 
                                            "Da 55 a 59 anni", 
                                            "Da 60 a 64 anni", 
                                            "Da 65 a 69 anni", 
                                            "Da 70 a 74 anni",
                                            "75 anni e oltre"))
sdo_age_gender2 %>%
  dplyr::select(`Categoria età`, MASCHI, FEMMINE, ANNO) %>%
  dplyr::mutate(DIMISSIONI_TOT = MASCHI + FEMMINE) %>%
  dplyr::select(`Categoria età`, DIMISSIONI_TOT, ANNO) %>%
 
  ggplot(., aes(x = `Categoria età`,y = DIMISSIONI_TOT, fill = ANNO)) +
  geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER ETÀ",
       subtitle = "Riabilitazione - Regime ordinario",
       caption = "Source: Ministero della Salute") +
  ylab("DIMISSIONI") + 
  xlab("CATEGORIA ETÀ")

  

```


### GIORNATE DI DEGENZA {.tabset}

The following graph shows the *Giorni di Degenza* for each MDC and over the years of analysis.
```{r, echo=FALSE, include=TRUE}
SDO_ordinario_riab %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(GIORNI_DEGENZA = sum(`GIORNATE DI DEGENZA`)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = GIORNI_DEGENZA,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "GIORNI DI DEGENZA",
              subtitle = "Riabilitazione - Regime ordinario",
       caption = "Source: Ministero della Salute") + 
  ylab("GIORNI DI DEGENZA") + 
    xlab("CLASSE MDC")


```


Table 1.3.3 provides a summary for *Giorni di Degenza* by MDC for each year.

```{r, echo=FALSE, include=TRUE}
overall_ordinario_degenza_riab <- SDO_ordinario_riab %>%
  dplyr::select(CLASSE_MDC, `GIORNATE DI DEGENZA`, ANNO)

overall_ordinario_degenza_riab %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 1.3.3"
                )

```



The following graph shows the Mean value for *Giorni di Degenza* for each MDC.

#### 2019 {-}
```{r, echo=FALSE, include=TRUE}

SDO_ordinario_riab %>%
  dplyr::filter(ANNO == "2019") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Riabilitazione - Regime ordinario",caption = "Source: Ministero della Salute",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  




```

#### 2018 {-}
```{r, echo=FALSE, include=TRUE}

SDO_ordinario_riab %>%
  dplyr::filter(ANNO == "2018") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Riabilitazione - Regime ordinario", caption = "Source: Ministero della Salute",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  




```

#### 2017 {-}
```{r, echo=FALSE, include=TRUE}

SDO_ordinario_riab %>%
  dplyr::filter(ANNO == "2017") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Riabilitazione - Regime ordinario", caption = "Source: Ministero della Salute",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  




```


#### 2016 {-}
```{r, echo=FALSE, include=TRUE}

SDO_ordinario_riab %>%
  dplyr::filter(ANNO == "2016") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Riabilitazione - Regime ordinario", caption = "Source: Ministero della Salute",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  




```

### {-}

Table 1.3.4 provides a summary for the mean value for *"Giorni di Degenza"* for each MDC.

```{r, echo=FALSE, include=TRUE}

SDO_ordinario_riab %>%
  dplyr::select(CLASSE_MDC, `DEGENZA MEDIA (giorni)`, ANNO) %>%
  mutate_at(vars(`DEGENZA MEDIA (giorni)`), funs(round), digits = 3) %>%
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.3.4'
    
  )
  


```


## Riabilitazione - Regime diurno.

### DIMISSIONI

Table 1.4.1 provides a summary of the hospedalization discharges in *"Riabilitazione - Regime diurno"* and the variation from year to year.

```{r, echo=FALSE, include=TRUE}
summary_diurno_riab <- SDO_diurno_riab %>% 
  dplyr::group_by(ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3))

summary_diurno_riab %>% 
  DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 1.4.1')


```



This bar chart shows the hospital discharges by MDC for each year of the analysis.
```{r, echo=FALSE, include=TRUE}

SDO_diurno_riab %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = DIMISSIONI,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER MDC",
              subtitle = "Riabilitazione - Regime diurno", caption = "Source: Ministero della Salute") + 
  xlab("CLASSE MDC")

  
```

In the case of activity *Riabilitazione - Regime diurno*, there are a few MDC with a considerable level of discharges: **MDC 01 - Malattie e disturbi del sistema nervoso**;
**MDC 08 - Malattie e disturbi del sistema muscolo-scheletrico e del tessuto connettivo**; **MDC 23 - Fattori che influenzano lo stato di salute ed il ricorso ai servizi sanitari**.

The following table provides a summary of the discharges for each MDC class and for each year.

```{r, echo=FALSE, include=TRUE}
#overall discharges for acuti - regime diurno for the 4 years
overall_diurno_riab <- SDO_diurno_riab %>%
  dplyr::select(CLASSE_MDC, DIMISSIONI, ANNO)

overall_diurno_riab %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.4.2')
```


The bar chart below shows the distribution of discharges in *Riabilitazione - Regime diurno* per age category, for each year of analysis.

```{r, echo=FALSE, include=TRUE}

sdo_age_gender2 <- sdo_age_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione - Regime diurno") %>%
  dplyr::mutate_at(vars(`Categoria età`), factor)

sdo_age_gender2$`Categoria età` <- factor(sdo_age_gender2$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 9 anni",
                                            "Da 10 a 14 anni",
                                            "Da 15 a 19 anni",
                                            "Da 20 a 24 anni",
                                            "Da 25 a 29 anni", 
                                            "Da 30 a 34 anni", 
                                            "Da 35 a 39 anni",
                                            "Da 40 a 44 anni",
                                            "Da 45 a 49 anni", 
                                            "Da 50 a 54 anni", 
                                            "Da 55 a 59 anni", 
                                            "Da 60 a 64 anni", 
                                            "Da 65 a 69 anni", 
                                            "Da 70 a 74 anni",
                                            "75 anni e oltre"))
sdo_age_gender2 %>%
  dplyr::select(`Categoria età`, MASCHI, FEMMINE, ANNO) %>%
  dplyr::mutate(DIMISSIONI_TOT = MASCHI + FEMMINE) %>%
  dplyr::select(`Categoria età`, DIMISSIONI_TOT, ANNO) %>%
 
  ggplot(., aes(x = `Categoria età`,y = DIMISSIONI_TOT, fill = ANNO)) +
  geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER ETÀ",
       subtitle = "Riabilitazione - Regime diurno",
       caption = "Source: Ministero della Salute") + 
  xlab("CATEGORIA ETÀ")

  

```


### ACCESSI {.tabset}

The following graph shows the *Accessi* for each MDC and over the years of analysis.
```{r, echo=FALSE, include=TRUE}
SDO_diurno_riab %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(Accessi = sum(ACCESSI)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = Accessi,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "ACCESSI",
              subtitle = "Riabilitazione - Regime diurno",
       caption = "Source: Ministero della Salute") + 
  ylab("ACCESSI") + 
  xlab("CLASSE MDC")


```


Table 1.4.3 provides a summary for *Accessi* by MDC for each year.

```{r, echo=FALSE, include=TRUE}
overall_diurno_accessi_riab <- SDO_diurno_riab %>%
  dplyr::select(CLASSE_MDC, ACCESSI, ANNO)

overall_diurno_accessi_riab %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 1.4.3"
                )

```



The following graph shows the Mean value for *Accessi* for each MDC.

#### 2019 {-}
```{r, echo=FALSE, include=TRUE}

SDO_diurno_riab %>%
  dplyr::filter(ANNO == "2019") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `NUMERO MEDIO DI ACCESSI`), 
                    y = `NUMERO MEDIO DI ACCESSI`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER MDC",
              subtitle = "Riabilitazione - Regime diurno",caption = "Source: Ministero della Salute",
       x = "CLASSE MDC",
       y = "ACCESSI") 
  




```

#### 2018 {-}
```{r, echo=FALSE, include=TRUE}

SDO_diurno_riab %>%
  dplyr::filter(ANNO == "2018") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `NUMERO MEDIO DI ACCESSI`), 
                    y = `NUMERO MEDIO DI ACCESSI`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER MDC",
              subtitle = "Riabilitazione - Regime diurno", caption = "Source: Ministero della Salute",
       x = "CLASSE MDC",
       y = "ACCESSI") 
  




```


#### 2017 {-}
```{r, echo=FALSE, include=TRUE}

SDO_diurno_riab %>%
  dplyr::filter(ANNO == "2017") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `NUMERO MEDIO DI ACCESSI`), 
                    y = `NUMERO MEDIO DI ACCESSI`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER MDC",
              subtitle = "Riabilitazione - Regime diurno", caption = "Source: Ministero della Salute",
       x = "CLASSE MDC",
       y = "ACCESSI") 
  




```



#### 2016 {-}
```{r, echo=FALSE, include=TRUE}

SDO_diurno_riab %>%
  dplyr::filter(ANNO == "2016") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `NUMERO MEDIO DI ACCESSI`), 
                    y = `NUMERO MEDIO DI ACCESSI`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER MDC",
              subtitle = "Riabilitazione - Regime diurno", caption = "Source: Ministero della Salute",
       x = "CLASSE MDC",
       y = "ACCESSI") 
  




```


### {-}


Table 1.4.4 provides a summary for the mean value for *Accessi* for each MDC.

```{r, echo=FALSE, include=TRUE}

SDO_diurno_riab %>%
  dplyr::select(CLASSE_MDC, `NUMERO MEDIO DI ACCESSI`, ANNO) %>%
  mutate_at(vars(`NUMERO MEDIO DI ACCESSI`), funs(round), digits = 3) %>%
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 4.4'
    
  )
  


```


## Lungodegenza.

### DIMISSIONI

Table 1.5.1 provides a summary of the hospedalization discharges in [*Lungodegenza*](#glossario) and the variation from year to year.

```{r, echo=FALSE, include=TRUE}
summary_lungodeg <- SDO_lungodegenza %>% 
  dplyr::group_by(ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3))

summary_ordinario_riab %>% 
  DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 5.1')



```

This bar chart shows the hospital discharges by MDC for each year of the analysis.
```{r, echo=FALSE, include=TRUE}

SDO_lungodegenza %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = DIMISSIONI,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER MDC",
              subtitle = "Lungodegenza", 
       caption = "Source: Ministero della Salute") + 
  xlab("CLASSE MDC")

  
```

As shown from the bar chart, over the 4 years of analysis, the MDC class with the greatest number of dicharges for the activity *Lungodegenza* are: **MDC 08 - Malattie e disturbi del sistema muscolo-scheletrico e del tessuto connettivo**; **MDC 01 - Malattie e disturbi del sistema nervoso**; **MDC 04 - Malattie e disturbi dell'apparato respiratorio**.

The following table provides a summary of the discharges for each MDC class and for each year.

```{r, echo=FALSE, include=TRUE}
#overall discharges for acuti - regime diurno for the 4 years
overall_lungod <- SDO_lungodegenza %>%
  dplyr::select(CLASSE_MDC, DIMISSIONI, ANNO)

overall_lungod %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.5.2')
```

The bar chart below shows the distribution of discharges in *Lungodegenza* per age category, for each year of analysis.

```{r, echo=FALSE, include=TRUE}

sdo_age_gender2 <- sdo_age_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Lungodegenza") %>%
  dplyr::mutate_at(vars(`Categoria età`), factor)

sdo_age_gender2$`Categoria età` <- factor(sdo_age_gender2$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 9 anni",
                                            "Da 10 a 14 anni",
                                            "Da 15 a 19 anni",
                                            "Da 20 a 24 anni",
                                            "Da 25 a 29 anni", 
                                            "Da 30 a 34 anni", 
                                            "Da 35 a 39 anni",
                                            "Da 40 a 44 anni",
                                            "Da 45 a 49 anni", 
                                            "Da 50 a 54 anni", 
                                            "Da 55 a 59 anni", 
                                            "Da 60 a 64 anni", 
                                            "Da 65 a 69 anni", 
                                            "Da 70 a 74 anni",
                                            "75 anni e oltre"))
sdo_age_gender2 %>%
  dplyr::select(`Categoria età`, MASCHI, FEMMINE, ANNO) %>%
  dplyr::mutate(DIMISSIONI_TOT = MASCHI + FEMMINE) %>%
  dplyr::select(`Categoria età`, DIMISSIONI_TOT, ANNO) %>%
 
  ggplot(., aes(x = `Categoria età`,y = DIMISSIONI_TOT, fill = ANNO)) +
  geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER ETÀ",
       subtitle = "Lungodegenza",
       caption = "Source: Ministero della Salute") +
  xlab("CATEGORIA ETÀ")

  

```

### GIORNATE DI DEGENZA {.tabset}

The following graph shows the *Giorni di Degenza* for each MDC and over the years of analysis.
```{r, echo=FALSE, include=TRUE}
SDO_lungodegenza %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(GIORNI_DEGENZA = sum(`GIORNATE DI DEGENZA`)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = GIORNI_DEGENZA,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "GIORNI DI DEGENZA",
              subtitle = "Lungodegenza",
       caption = "Source: Ministero della Salute") + 
  ylab("GIORNI DI DEGENZA") + 
  xlab("CLASSE MDC")


```


Table 1.5.3 provides a summary for *Giorni di Degenza* by MDC for each year.

```{r, echo=FALSE, include=TRUE}
overall_lungod <- SDO_lungodegenza %>%
  dplyr::select(CLASSE_MDC, `GIORNATE DI DEGENZA`, ANNO)

overall_lungod %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 1.5.3"
                )

```



The following graph shows the Mean value for *Giorni di Degenza* for each MDC.

#### 2019 {-}
```{r, echo=FALSE, include=TRUE}

SDO_lungodegenza %>%
  dplyr::filter(ANNO == "2019") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Lungodegenza",
       x = "CLASSE MDC", 
       caption = "Source: Ministero della Salute",
       y = "GIORNI DI DEGENZA") 
  




```

#### 2018 {-}
```{r, echo=FALSE, include=TRUE}

SDO_lungodegenza %>%
  dplyr::filter(ANNO == "2018") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Lungodegenza",
       x = "CLASSE MDC",
       caption = "Source: Ministero della Salute",
       y = "GIORNI DI DEGENZA") 
  




```

#### 2017 {-}
```{r, echo=FALSE, include=TRUE}

SDO_lungodegenza %>%
  dplyr::filter(ANNO == "2017") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Lungodegenza",
       x = "CLASSE MDC",
       caption = "Source: Ministero della Salute",
       y = "GIORNI DI DEGENZA") 
  




```


#### 2016 {-}
```{r, echo=FALSE, include=TRUE}

SDO_lungodegenza %>%
  dplyr::filter(ANNO == "2016") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Lungodegenza",
       x = "CLASSE MDC",
       caption = "Source: Ministero della Salute",
       y = "GIORNI DI DEGENZA") 
  




```

### {-}

Table 1.5.4 provides a summary for the mean value for *"Giorni di Degenza"* for each MDC.

```{r, echo=FALSE, include=TRUE}

SDO_lungodegenza %>%
  dplyr::select(CLASSE_MDC, `DEGENZA MEDIA (giorni)`, ANNO) %>%
  mutate_at(vars(`DEGENZA MEDIA (giorni)`), funs(round), digits = 3) %>%
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.5.4'
    
  )
  


```



# TASSI DI OSPEDALIZZAZIONE 

## Overview in Italia

### TASSO DI OSPEDALIZZAZIONE IN ITALIA PER ATTIVITÀ
The following bar chart shows the evolution of the [*Tasso di ospedalizzazione*](#glossario) in Italy in the period of analysis.
As shown by the graph, there has been a decrease in the hospitalization rates per 1000 inhabitants, in particular for the activity *"Acuti - Regime ordinario"* (from 101.624 in 2016 to 97.611 in 2019).
```{r, echo=FALSE, include=TRUE}
HR_summary_act <- HR_age %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITALIA") %>%
  dplyr::group_by(ANNO, `ATTIVITÀ`) %>%
  dplyr::mutate(`ATTIVITÀ` = stringr::str_remove_all(string = `ATTIVITÀ`,
                                                     pattern = "Regime")) %>%
  dplyr::select(`Tasso complessivo`, ANNO, `ATTIVITÀ`) 

  ggplot(data = HR_summary_act, 
         mapping = aes(x = `ATTIVITÀ`, 
                       y = `Tasso complessivo` ,
                       fill = ANNO)) +
  geom_bar(position = "dodge",
           width = .5,
           stat = "identity", 
           color = "black") + 
  coord_flip() +
  theme(axis.text.x  = element_text(angle = 90, 
                                     hjust = 1, 
                                    vjust = 0.5)) + 
   labs(title = "TASSO DI OSPEDALIZZAZIONE (per 1000 abitanti)",
              subtitle = "ITALIA",
        caption = "Source: Ministero della Salute") + 
    xlab("TASSO")
  
```

Table 2.1.1 provides an overview on the Hospitalization rates (per 1000 inhabitants) in Italy during the period 2016-2019.

```{r, echo=FALSE, include=TRUE}

HR_age %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITALIA") %>%
  dplyr::rename(`Tasso complessivo Italia` = "Tasso complessivo") %>%
  dplyr::select(`ATTIVITÀ`, `Tasso complessivo Italia`, ANNO) %>%
  dplyr::mutate_at(vars(`Tasso complessivo Italia`), funs(round), digits = 3) %>%
  
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 2.1"
  )

```

### TASSI DI OSPEDALIZZAZIONE PER GENERE

The graph below shows the hospitalization rates in Italy per gender and for the different activities. In this case, there has been a small reduction for both gender and for all the activities

```{r, echo=FALSE, include=TRUE}
gender_OR <- HR_gender %>%
  dplyr::group_by(ANNO, `ATTIVITÀ`) 


                                          
# reshape the dataframe in order to plot.

male <- gender_OR %>%
  dplyr::select(1, 2, 4, 5) %>%
  dplyr::rename(TASSO = "MASCHI") %>%
  dplyr::mutate(GENERE = "MASCHI") 

female <- gender_OR %>%
  dplyr::select(1,3, 4, 5) %>%
  dplyr::rename(TASSO = "FEMMINE") %>%
  dplyr::mutate(GENERE = "FEMMINE") 


Gend_HR_total <- dplyr::bind_rows(male, female) %>%
  dplyr::mutate_at(vars(TASSO), as.numeric)

Italy_HR <- Gend_HR_total %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITALIA") %>%
  dplyr::rename(tasso_it = "TASSO") %>%
  dplyr::mutate(`ATTIVITÀ` = stringr::str_remove_all(string = `ATTIVITÀ`,
                                                     pattern = "Regime")) 
  
  ggplot( data = Italy_HR, 
          aes(x =`ATTIVITÀ`, y = tasso_it, fill = GENERE)) +
  geom_bar(
    stat = "identity",
    position = "dodge"
    ) +
    coord_flip() +
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "TASSO DI OSPEDALIZZAZIONE (per genere, per 1000 abitanti)",
              subtitle = "Italia",
       caption = "Source: Ministero della Salute") +
    ylab(" ") + 
  facet_wrap(~ANNO)
  


```

Table 2.1.2 provides a summary for the data about hospitalization rates by gender in Italy.
```{r, echo=FALSE, include=TRUE}

Gend_HR_total %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITALIA") %>%
  dplyr::rename(tasso_it = "TASSO") %>%
  dplyr::select(-1) %>%
  dplyr::mutate_at(vars(tasso_it), round, digits = 3) %>%
  dplyr::rename(`Tasso ospedalizzazione` = "tasso_it") %>%
  
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 2.1.2"
  )


```

### TASSO DI OSPEDALIZZAZIONE PER CATEGORIA DI ETÀ ED ATTIVITÀ

The following graph represents the evolution of the hospitalization rates by age category in Italy and for each activity.
```{r, echo=FALSE, include=TRUE}

convert_HR_age <- function(activity){
  
  HR_summary_it <- HR_age_cat %>%
    dplyr::select(`Categoria età`, activity, ANNO) %>%
    dplyr::rename(TASSO = activity) %>%
    dplyr::mutate(`ATTIVITÀ` = activity) %>%
    dplyr::slice(-n())
  HR_summary_it$`Categoria età` <- factor(HR_summary_it$`Categoria età`,
                                      c("Meno di 1 anno",
                                        "Da 1 a 4 anni",
                                        "Da 5 a 14 anni",
                                        "Da 15 a 24 anni",
                                        "Da 25 a 44 anni", 
                                        "Da 45 a 64 anni", 
                                        "Da 65 a 74 anni", 
                                        "75 anni e oltre"))
  return(HR_summary_it)
}

activity_list <- list("Acuti - Regime ordinario", "Acuti - Regime diurno",
                      "Riabilitazione - Regime ordinario", 
                      "Riabilitazione - Regime diurno",
                      "Lungodegenza")

list_HR_age <- purrr::pmap(list(activity_list), convert_HR_age)

HR_age_it <- dplyr::bind_rows(list_HR_age) %>%
  dplyr::filter(!is.na(`Categoria età`)) %>%
  dplyr::group_by(ANNO, `ATTIVITÀ`) 

  ggplot(data = HR_age_it, aes(x = `Categoria età`,
                                   y = `TASSO`,
                                   fill = `ATTIVITÀ`,
                                   )) +
  geom_bar(stat = "identity",
           position = "dodge") +
    theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "TASSO DI OSPEDALIZZAZIONE (PER ETÀ, per 1000 abitanti)",
              subtitle = "Italia",
       caption = "Source: Ministero della Salute") +
    ylab(" ") +
    xlab("CATEGORIA ETÀ")+
  facet_wrap(~ANNO)
  
     

```

Table 2.1.3 provides the summary for the hospitalization rates in Italy by age category. 
```{r, echo=FALSE, include=TRUE}

HR_age_it <- dplyr::bind_rows(list_HR_age) %>%
  dplyr::filter(!is.na(`Categoria età`)) %>%
  dplyr::mutate_at(vars(TASSO), round, digits = 3)

HR_age_it %>%
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 2.1.3"
  )

```


## Acuti - Regime ordinario

Table 2.2.1 shows the hospitalization rates for the activity *Acuti - Regime ordinario* for the 4 years of analysis and the corresponding percentage variation.

```{r, echo=FALSE, include=TRUE}
HR_summary_act %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti -  ordinario") %>%
  dplyr::mutate(`ATTIVITÀ` = "Acuti - Regime ordinario") %>%  
  dplyr::rename(TASSO = "Tasso complessivo") %>%
  ungroup() %>%
  dplyr::mutate("VARIAZIONE %" = round((TASSO / lag(TASSO) -1) * 100, 
                                       digits   = 3)) %>%
  DT::datatable(
    options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 2.2.1')
  

```


### TASSO PER CATEGORIE DI ETÀ
As shown by the graph, through the years of analysis the hospitalization rates by age category remained stable for the activity *Acuti - Regime ordinario*.

```{r, echo=FALSE, include=TRUE}

HR_summary <- HR_age_cat %>%
  dplyr::filter(`Categoria età` != "TOTALE") %>%
  dplyr::select(`Categoria età`, `Acuti - Regime ordinario`, ANNO) %>%
  dplyr::group_by(ANNO) 
  
HR_summary$`Categoria età` <- factor(HR_summary$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 14 anni",
                                            "Da 15 a 24 anni",
                                            "Da 25 a 44 anni", 
                                            "Da 45 a 64 anni", 
                                            "Da 65 a 74 anni", 
                                            "75 anni e oltre"))

  ggplot(data = HR_summary,
         aes(x = `Categoria età`, y = `Acuti - Regime ordinario`, fill = ANNO)) +
  geom_bar( stat = "identity",
            position = "dodge") +
     theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "TASSO DI OSPEDALIZZAZIONE (per età, per 1000 abitanti)",
              subtitle = "Acuti - Regime ordinario",
       caption = "Source: Ministero della Salute") +
    ylab(" ") + 
    xlab("CATEGORIA ETÀ")


```



Table 2.2.2 represents the data for age category in *Acuti - Regime ordinario* for each year.


```{r, echo=FALSE, include=TRUE}

HR_summary %>%
  dplyr::rename(`Tasso di ospedalizz. (per 1000 ab.)` = "Acuti - Regime ordinario") %>%
  dplyr::mutate_at(vars(`Tasso di ospedalizz. (per 1000 ab.)`), round, digits = 3) %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 2.2.2"
                )

  

```


### TASSO PER REGIONE E SESSO

The following graphs show the evolution of the hospitalization rate in Italy by region and gender in the period 2016-2019. The horizontal blue line displays the hospitalization rates in all Italy for the male gender, the red one for the female gender.

```{r, echo=FALSE, include=TRUE}

gender_OR <- HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti - Regime ordinario") %>%
  dplyr::group_by(ANNO) 

gender_OR$`REGIONE DI RESIDENZA` <- rep(c("Pie", "VdA", "Lom", "Blz", "Trn", "Ven",
                                      "FVG", "Lig", "EmR", "Tos", "Umb", "Mar",
                                      "Laz", "Abr", "Mol", "Cam", "Pug", "Bas",
                                      "Cal", "Sic", "Sar", "ITA"),4
                                      )
gender_OR$`REGIONE DI RESIDENZA` <- factor(gender_OR$`REGIONE DI RESIDENZA`,
                                          c( "Pie", "VdA", "Lom", "Blz",
                                             "Trn", "Ven", "FVG", "Lig", 
                                             "EmR", "Tos", "Umb", "Mar",      
                                             "Laz", "Abr", "Mol", "Cam", 
                                             "Pug", "Bas","Cal", "Sic",
                                             "Sar", "ITA")
                                          )
# reshape the dataframe in order to plot.

male <- gender_OR %>%
  dplyr::select(1, 2, 5) %>%
  dplyr::rename(TASSO = "MASCHI") %>%
  dplyr::mutate(GENERE = "MASCHI") 

female <- gender_OR %>%
  dplyr::select(1,3,5) %>%
  dplyr::rename(TASSO = "FEMMINE") %>%
  dplyr::mutate(GENERE = "FEMMINE") 


Gend_HR_total <- dplyr::bind_rows(male, female) %>%
  dplyr::mutate_at(vars(TASSO), as.numeric)

Italy_HR <- Gend_HR_total %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITA") %>%
  dplyr::rename(tasso_it = "TASSO")

Gend_HR_without_ita <- Gend_HR_total %>%
  filter(`REGIONE DI RESIDENZA` != "ITA")


p <- ggplot(data = Gend_HR_without_ita, aes( x = `REGIONE DI RESIDENZA`, 
                                 y = TASSO,
                                 fill = GENERE)) + 
  geom_bar(stat = "identity",
           position = "dodge") + 
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "MASCHI"), aes(yintercept = tasso_it), 
             color = "blue") +
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "FEMMINE"), aes(yintercept = tasso_it), 
             color = "red") +
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +

  facet_wrap(~ANNO) +
  labs(
    title = "Tasso di ospedalizzazione per regione e sesso (per 1000 abitanti)",
    subtitle = "Acuti - Regime ordinario",
    caption = "Source: Ministero della Salute"
  )
p 


```


Table 2.2.3 shows the hospitalization rate for each region, by gender and year, for the activity *Acuti - Regime ordinario*.


```{r, echo=FALSE, include=TRUE}

HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti - Regime ordinario") %>%
  dplyr::group_by(ANNO)  %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), as.numeric) %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), round, digits = 3) %>% 
  dplyr::rename(`Tasso osp. Maschi` = "MASCHI",
                `Tasso osp. Femmine` = "FEMMINE") %>%
  dplyr::select(1:3, 5) %>%
  
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 2.2.3"
  )

```


## Acuti - Regime diurno

Table 3.1.1 shows the hospitalization rates for the activity *Acuti - Regime diurno* for the 4 years of analysis and the corresponding percentage variation.

```{r, echo=FALSE, include=TRUE}
HR_summary_act %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti -  diurno") %>%
  dplyr::mutate(`ATTIVITÀ` = "Acuti - Regime diurno") %>%  
  dplyr::rename(TASSO = "Tasso complessivo") %>%
  ungroup() %>%
  dplyr::mutate("VARIAZIONE %" = round((TASSO / lag(TASSO) -1) * 100, 
                                       digits   = 3)) %>%
  DT::datatable(
    options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 3.1.1')
  

```

### TASSO PER CATEGORIE DI ETÀ
The graph below shows that through the years of analysis the hospitalization rates by age category is decreased for all the age categories for the activity *Acuti - Regime diurno*.

```{r, echo=FALSE, include=TRUE}

HR_summary <- HR_age_cat %>%
  dplyr::filter(`Categoria età` != "TOTALE") %>%
  dplyr::select(`Categoria età`, `Acuti - Regime diurno`, ANNO) %>%
  dplyr::group_by(ANNO) 
  
HR_summary$`Categoria età` <- factor(HR_summary$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 14 anni",
                                            "Da 15 a 24 anni",
                                            "Da 25 a 44 anni", 
                                            "Da 45 a 64 anni", 
                                            "Da 65 a 74 anni", 
                                            "75 anni e oltre"))

  ggplot(data = HR_summary,
         aes(x = `Categoria età`, y = `Acuti - Regime diurno`, fill = ANNO)) +
  geom_bar( stat = "identity",
            position = "dodge") +
     theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "TASSO DI OSPEDALIZZAZIONE (per età, per 1000 abitanti)",
              subtitle = "Acuti - Regime diurno",
       caption = "Source: Ministero della Salute") +
    ylab(" ") + 
        xlab("CATEGORIA ETÀ")



```


Table 3.1.2 represents the data for age category in *Acuti - Regime diurno* for each year.


```{r, echo=FALSE, include=TRUE}

HR_summary %>%
  dplyr::rename(`Tasso di ospedalizz. (per 1000 ab.)` = "Acuti - Regime diurno") %>%
  dplyr::mutate_at(vars(`Tasso di ospedalizz. (per 1000 ab.)`), round, digits = 3) %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 3.1.2"
                )

  

```


### TASSO PER REGIONE E SESSO

The following graphs show the evolution of the hospitalization rate in Italy by region and gender in the period 2016-2019. The horizontal blue line displays the hospitalization rates in Italy for the male gender, the red one for the female gender.

```{r, echo=FALSE, include=TRUE}

gender_OR <- HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti - Regime diurno") %>%
  dplyr::group_by(ANNO) 

gender_OR$`REGIONE DI RESIDENZA` <- rep(c("Pie", "VdA", "Lom", "Blz", "Trn", "Ven",
                                      "FVG", "Lig", "EmR", "Tos", "Umb", "Mar",
                                      "Laz", "Abr", "Mol", "Cam", "Pug", "Bas",
                                      "Cal", "Sic", "Sar", "ITA"),4
                                      )
gender_OR$`REGIONE DI RESIDENZA` <- factor(gender_OR$`REGIONE DI RESIDENZA`,
                                          c( "Pie", "VdA", "Lom", "Blz",
                                             "Trn", "Ven", "FVG", "Lig", 
                                             "EmR", "Tos", "Umb", "Mar",      
                                             "Laz", "Abr", "Mol", "Cam", 
                                             "Pug", "Bas","Cal", "Sic",
                                             "Sar", "ITA")
                                          )
# reshape the dataframe in order to plot.

male <- gender_OR %>%
  dplyr::select(1, 2, 5) %>%
  dplyr::rename(TASSO = "MASCHI") %>%
  dplyr::mutate(GENERE = "MASCHI") 

female <- gender_OR %>%
  dplyr::select(1,3,5) %>%
  dplyr::rename(TASSO = "FEMMINE") %>%
  dplyr::mutate(GENERE = "FEMMINE") 


Gend_HR_total <- dplyr::bind_rows(male, female) %>%
  dplyr::mutate_at(vars(TASSO), as.numeric)

Italy_HR <- Gend_HR_total %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITA") %>%
  dplyr::rename(tasso_it = "TASSO")

Gend_HR_without_ita <- Gend_HR_total %>%
  filter(`REGIONE DI RESIDENZA` != "ITA")


p <- ggplot(data = Gend_HR_without_ita, aes( x = `REGIONE DI RESIDENZA`, 
                                 y = TASSO,
                                 fill = GENERE)) + 
  geom_bar(stat = "identity",
           position = "dodge") + 
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "MASCHI"), aes(yintercept = tasso_it), 
             color = "blue") +
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "FEMMINE"), aes(yintercept = tasso_it), 
             color = "red") +
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +

  facet_wrap(~ANNO) +
  labs(
    title = "Tasso di ospedalizzazione per regione e sesso (per 1000 abitanti)",
    subtitle = "Acuti - Regime diurno",
    caption = "Source: Ministero della Salute"
  )
p 


```


Table 3.1.3 shows the hospitalization rate for each region, by gender and year, for the activity *Acuti - Regime diurno*.


```{r, echo=FALSE, include=TRUE}

HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti - Regime diurno") %>%
  dplyr::group_by(ANNO)  %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), as.numeric) %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), round, digits = 3) %>% 
  dplyr::rename(`Tasso osp. Maschi` = "MASCHI",
                `Tasso osp. Femmine` = "FEMMINE") %>%
  dplyr::select(1:3, 5) %>%
  
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 3.1.3"
  )

```





## Riabilitazione - Regime ordinario

Table 4.1.1 shows the hospitalization rates for the activity *Riabilitazione - Regime ordinario* for the 4 years of analysis and the corresponding percentage variation.

```{r, echo=FALSE, include=TRUE}
HR_summary_act %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione -  ordinario") %>%
  dplyr::mutate(`ATTIVITÀ` = "Riabilitazione - Regime ordinario") %>%  
  dplyr::rename(TASSO = "Tasso complessivo") %>%
  ungroup() %>%
  dplyr::mutate("VARIAZIONE %" = round((TASSO / lag(TASSO) -1) * 100, 
                                       digits   = 3)) %>%
  DT::datatable(
    options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 4.1.1')
  

```

### TASSO PER CATEGORIE DI ETÀ
As shown by the graph, through the years of analysis the hospitalization rates remained stable for some of the age categories, while decreased for others, in particular for the categories: *"Da 65 a 74 anni"* and *"75 anni e oltre"* for the activity *Riabilitazione - Regime ordinario*.

```{r, echo=FALSE, include=TRUE}

HR_summary <- HR_age_cat %>%
  dplyr::filter(`Categoria età` != "TOTALE") %>%
  dplyr::select(`Categoria età`, `Riabilitazione - Regime ordinario`, ANNO) %>%
  dplyr::group_by(ANNO) 
  
HR_summary$`Categoria età` <- factor(HR_summary$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 14 anni",
                                            "Da 15 a 24 anni",
                                            "Da 25 a 44 anni", 
                                            "Da 45 a 64 anni", 
                                            "Da 65 a 74 anni", 
                                            "75 anni e oltre"))

  ggplot(data = HR_summary,
         aes(x = `Categoria età`, 
             y = `Riabilitazione - Regime ordinario`,
             fill = ANNO)) +
  geom_bar( stat = "identity",
            position = "dodge") +
     theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "TASSO DI OSPEDALIZZAZIONE (per età, per 1000 abitanti)",
              subtitle = "Riabilitazione - Regime ordinario",
       caption = "Source: Ministero della Salute") +
    ylab(" ") + 
        xlab("CATEGORIA ETÀ")



```


Table 4.1.2 represents the data for age category in *Riabilitazione - Regime ordinario* for each year.


```{r, echo=FALSE, include=TRUE}

HR_summary %>%
  dplyr::rename(`Tasso di ospedalizz. (per 1000 ab.)` = "Riabilitazione - Regime ordinario") %>%
  dplyr::mutate_at(vars(`Tasso di ospedalizz. (per 1000 ab.)`), round, digits = 3) %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 4.1.2"
                )

  

```


### TASSO PER REGIONE E SESSO

The following graphs show the evolution of the hospitalization rate in Italy by region and gender in the period 2016-2019. The horizontal blue line displays the hospitalization rates in Italy for the male gender, the red one for the female gender.

```{r, echo=FALSE, include=TRUE}

gender_OR <- HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione - Regime ordinario") %>%
  dplyr::group_by(ANNO) 

gender_OR$`REGIONE DI RESIDENZA` <- rep(c("Pie", "VdA", "Lom", "Blz", "Trn", "Ven",
                                      "FVG", "Lig", "EmR", "Tos", "Umb", "Mar",
                                      "Laz", "Abr", "Mol", "Cam", "Pug", "Bas",
                                      "Cal", "Sic", "Sar", "ITA"),4
                                      )
gender_OR$`REGIONE DI RESIDENZA` <- factor(gender_OR$`REGIONE DI RESIDENZA`,
                                          c( "Pie", "VdA", "Lom", "Blz",
                                             "Trn", "Ven", "FVG", "Lig", 
                                             "EmR", "Tos", "Umb", "Mar",      
                                             "Laz", "Abr", "Mol", "Cam", 
                                             "Pug", "Bas","Cal", "Sic",
                                             "Sar", "ITA")
                                          )
# reshape the dataframe in order to plot.

male <- gender_OR %>%
  dplyr::select(1, 2, 5) %>%
  dplyr::rename(TASSO = "MASCHI") %>%
  dplyr::mutate(GENERE = "MASCHI") 

female <- gender_OR %>%
  dplyr::select(1,3,5) %>%
  dplyr::rename(TASSO = "FEMMINE") %>%
  dplyr::mutate(GENERE = "FEMMINE") 


Gend_HR_total <- dplyr::bind_rows(male, female) %>%
  dplyr::mutate_at(vars(TASSO), as.numeric)

Italy_HR <- Gend_HR_total %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITA") %>%
  dplyr::rename(tasso_it = "TASSO")

Gend_HR_without_ita <- Gend_HR_total %>%
  filter(`REGIONE DI RESIDENZA` != "ITA")


p <- ggplot(data = Gend_HR_without_ita, aes( x = `REGIONE DI RESIDENZA`, 
                                 y = TASSO,
                                 fill = GENERE)) + 
  geom_bar(stat = "identity",
           position = "dodge") + 
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "MASCHI"), aes(yintercept = tasso_it), 
             color = "blue") +
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "FEMMINE"), aes(yintercept = tasso_it), 
             color = "red") +
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +

  facet_wrap(~ANNO) +
  labs(
    title = "Tasso di ospedalizzazione per regione e sesso (per 1000 abitanti)",
    subtitle = "Riabilitazione - Regime ordinario",
    caption = "Source: Ministero della Salute"
  )
p 


```


Table 4.1.3 shows the hospitalization rate for each region, by gender and year, for the activity *Riabilitazione - Regime ordinario*.


```{r, echo=FALSE, include=TRUE}

HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione - Regime ordinario") %>%
  dplyr::group_by(ANNO)  %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), as.numeric) %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), round, digits = 3) %>% 
  dplyr::rename(`Tasso osp. Maschi` = "MASCHI",
                `Tasso osp. Femmine` = "FEMMINE") %>%
  dplyr::select(1:3, 5) %>%
  
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 4.1.3"
  )

```


## Riabilitazione - Regime diurno

Table 5.1.1 shows the hospitalization rates for the activity *Riabilitazione - Regime diurno* for the 4 years of analysis and the corresponding percentage variation.

```{r, echo=FALSE, include=TRUE}
HR_summary_act %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione -  diurno") %>%
  dplyr::mutate(`ATTIVITÀ` = "Riabilitazione - Regime diurno") %>%  
  dplyr::rename(TASSO = "Tasso complessivo") %>%
  ungroup() %>%
  dplyr::mutate("VARIAZIONE %" = round((TASSO / lag(TASSO) -1) * 100, 
                                       digits   = 3)) %>%
  DT::datatable(
    options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 5.1.1')
  

```

### TASSO PER CATEGORIE DI ETÀ
As shown by the graph, through the years of analysis the hospitalization rates is increased for some of the age categories (*"Da 1 a 4 anni"* and *"Da 5 a 14 anni"*) and is decreased for some others (*"Da 45 a 64 anni"*; *"Da 65 a 74 anni"* and *"75 anni e oltre"* ) remained stable for the activity *Riabilitazione - Regime diurno*.

```{r, echo=FALSE, include=TRUE}

HR_summary <- HR_age_cat %>%
  dplyr::filter(`Categoria età` != "TOTALE") %>%
  dplyr::select(`Categoria età`, `Riabilitazione - Regime diurno`, ANNO) %>%
  dplyr::group_by(ANNO) 
  
HR_summary$`Categoria età` <- factor(HR_summary$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 14 anni",
                                            "Da 15 a 24 anni",
                                            "Da 25 a 44 anni", 
                                            "Da 45 a 64 anni", 
                                            "Da 65 a 74 anni", 
                                            "75 anni e oltre"))

  ggplot(data = HR_summary,
         aes(x = `Categoria età`, 
             y = `Riabilitazione - Regime diurno`,
             fill = ANNO)) +
  geom_bar( stat = "identity",
            position = "dodge") +
     theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "TASSO DI OSPEDALIZZAZIONE (per età, per 1000 abitanti)",
              subtitle = "Riabilitazione - Regime diurno",
       caption = "Source: Ministero della Salute") +
    ylab(" ") + 
        xlab("CATEGORIA ETÀ")



```


Table 5.1.2 represents the data for age category in *Riabilitazione - Regime diurno* for each year.


```{r, echo=FALSE, include=TRUE}

HR_summary %>%
  dplyr::rename(`Tasso di ospedalizz. (per 1000 ab.)` = "Riabilitazione - Regime diurno") %>%
  dplyr::mutate_at(vars(`Tasso di ospedalizz. (per 1000 ab.)`), round, digits = 3) %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 5.1.2"
                )

  

```


### TASSO PER REGIONE E SESSO 

The following graphs show the evolution of the hospitalization rate in Italy by region and gender in the period 2016-2019. The horizontal blue line displays the hospitalization rates in Italy for the male gender, the red one for the female gender.
 
```{r, echo=FALSE, include=TRUE}

gender_OR <- HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione - Regime diurno") %>%
  dplyr::group_by(ANNO) 

gender_OR$`REGIONE DI RESIDENZA` <- rep(c("Pie", "VdA", "Lom", "Blz", "Trn", "Ven",
                                      "FVG", "Lig", "EmR", "Tos", "Umb", "Mar",
                                      "Laz", "Abr", "Mol", "Cam", "Pug", "Bas",
                                      "Cal", "Sic", "Sar", "ITA"),4
                                      )
gender_OR$`REGIONE DI RESIDENZA` <- factor(gender_OR$`REGIONE DI RESIDENZA`,
                                          c( "Pie", "VdA", "Lom", "Blz",
                                             "Trn", "Ven", "FVG", "Lig", 
                                             "EmR", "Tos", "Umb", "Mar",      
                                             "Laz", "Abr", "Mol", "Cam", 
                                             "Pug", "Bas","Cal", "Sic",
                                             "Sar", "ITA")
                                          )
# reshape the dataframe in order to plot.

male <- gender_OR %>%
  dplyr::select(1, 2, 5) %>%
  dplyr::rename(TASSO = "MASCHI") %>%
  dplyr::mutate(GENERE = "MASCHI") 

female <- gender_OR %>%
  dplyr::select(1,3,5) %>%
  dplyr::rename(TASSO = "FEMMINE") %>%
  dplyr::mutate(GENERE = "FEMMINE") 


Gend_HR_total <- dplyr::bind_rows(male, female) %>%
  dplyr::mutate_at(vars(TASSO), as.numeric)

Italy_HR <- Gend_HR_total %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITA") %>%
  dplyr::rename(tasso_it = "TASSO")

Gend_HR_without_ita <- Gend_HR_total %>%
  filter(`REGIONE DI RESIDENZA` != "ITA")


p <- ggplot(data = Gend_HR_without_ita, aes( x = `REGIONE DI RESIDENZA`, 
                                 y = TASSO,
                                 fill = GENERE)) + 
  geom_bar(stat = "identity",
           position = "dodge") + 
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "MASCHI"), aes(yintercept = tasso_it), 
             color = "blue") +
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "FEMMINE"), aes(yintercept = tasso_it), 
             color = "red") +
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +

  facet_wrap(~ANNO) +
  labs(
    title = "Tasso di ospedalizzazione per regione e sesso (per 1000 abitanti)",
    subtitle = "Riabilitazione - Regime diurno",
    caption = "Source: Ministero della Salute"
  )
p 


```


Table 5.1.3 shows the hospitalization rate for each region, by gender and year, for the activity *Riabilitazione - Regime diurno*.


```{r, echo=FALSE, include=TRUE}

HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione - Regime diurno") %>%
  dplyr::group_by(ANNO)  %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), as.numeric) %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), round, digits = 3) %>% 
  dplyr::rename(`Tasso osp. Maschi` = "MASCHI",
                `Tasso osp. Femmine` = "FEMMINE") %>%
  dplyr::select(1:3, 5) %>%
  
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 5.1.3"
  )

```



## Lungodegenza

Table 6.1.1 shows the hospitalization rates for the activity *Lungodegenza* for the 4 years of analysis and the corresponding percentage variation.

```{r, echo=FALSE, include=TRUE}
HR_summary_act %>%
  dplyr::filter(`ATTIVITÀ` == "Lungodegenza") %>%
  dplyr::mutate(`ATTIVITÀ` = "Lungodegenza") %>%  
  dplyr::rename(TASSO = "Tasso complessivo") %>%
  ungroup() %>%
  dplyr::mutate("VARIAZIONE %" = round((TASSO / lag(TASSO) -1) * 100, 
                                       digits   = 3)) %>%
  DT::datatable(
    options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 6.1.1')
  

```

### TASSO PER CATEGORIE DI ETÀ
The graph below shows that the hospitalization rate is almost 0 for the earlier age categories and is much higher for the last ones. Through the years of analysis the hospitalization rates decreased for these latter categories for the activity *Lungodegenza*.

```{r, echo=FALSE, include=TRUE}

HR_summary <- HR_age_cat %>%
  dplyr::filter(`Categoria età` != "TOTALE") %>%
  dplyr::select(`Categoria età`, `Lungodegenza`, ANNO) %>%
  dplyr::group_by(ANNO) 
  
HR_summary$`Categoria età` <- factor(HR_summary$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 14 anni",
                                            "Da 15 a 24 anni",
                                            "Da 25 a 44 anni", 
                                            "Da 45 a 64 anni", 
                                            "Da 65 a 74 anni", 
                                            "75 anni e oltre"))

  ggplot(data = HR_summary,
         aes(x = `Categoria età`, 
             y = `Lungodegenza`,
             fill = ANNO)) +
  geom_bar( stat = "identity",
            position = "dodge") +
     theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "TASSO DI OSPEDALIZZAZIONE (per età, per 1000 abitanti)",
              subtitle = "Lungodegenza",
       caption = "Source: Ministero della Salute") +
    ylab(" ") + 
        xlab("CATEGORIA ETÀ")



```


Table 6.1.2 represents the data for age category in *Lungodegenza* for each year.


```{r, echo=FALSE, include=TRUE}

HR_summary %>%
  dplyr::rename(`Tasso di ospedalizz. (per 1000 ab.)` = "Lungodegenza") %>%
  dplyr::mutate_at(vars(`Tasso di ospedalizz. (per 1000 ab.)`), round, digits = 3) %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 6.1.2"
                )

  

```


### TASSO PER REGIONE E SESSO

The following graphs show the evolution of the hospitalization rate in Italy by region and gender in the period 2016-2019. The horizontal blue line displays the hospitalization rates in Italy for the male gender, the red one for the female gender.

```{r, echo=FALSE, include=TRUE}

gender_OR <- HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Lungodegenza") %>%
  dplyr::group_by(ANNO) 

gender_OR$`REGIONE DI RESIDENZA` <- rep(c("Pie", "VdA", "Lom", "Blz", "Trn", "Ven",
                                      "FVG", "Lig", "EmR", "Tos", "Umb", "Mar",
                                      "Laz", "Abr", "Mol", "Cam", "Pug", "Bas",
                                      "Cal", "Sic", "Sar", "ITA"),4
                                      )
gender_OR$`REGIONE DI RESIDENZA` <- factor(gender_OR$`REGIONE DI RESIDENZA`,
                                          c( "Pie", "VdA", "Lom", "Blz",
                                             "Trn", "Ven", "FVG", "Lig", 
                                             "EmR", "Tos", "Umb", "Mar",      
                                             "Laz", "Abr", "Mol", "Cam", 
                                             "Pug", "Bas","Cal", "Sic",
                                             "Sar", "ITA")
                                          )
# reshape the dataframe in order to plot.

male <- gender_OR %>%
  dplyr::select(1, 2, 5) %>%
  dplyr::rename(TASSO = "MASCHI") %>%
  dplyr::mutate(GENERE = "MASCHI") 

female <- gender_OR %>%
  dplyr::select(1,3,5) %>%
  dplyr::rename(TASSO = "FEMMINE") %>%
  dplyr::mutate(GENERE = "FEMMINE") 


Gend_HR_total <- dplyr::bind_rows(male, female) %>%
  dplyr::mutate_at(vars(TASSO), as.numeric)

Italy_HR <- Gend_HR_total %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITA") %>%
  dplyr::rename(tasso_it = "TASSO")

Gend_HR_without_ita <- Gend_HR_total %>%
  filter(`REGIONE DI RESIDENZA` != "ITA")


p <- ggplot(data = Gend_HR_without_ita, aes( x = `REGIONE DI RESIDENZA`, 
                                 y = TASSO,
                                 fill = GENERE)) + 
  geom_bar(stat = "identity",
           position = "dodge") + 
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "MASCHI"), aes(yintercept = tasso_it), 
             color = "blue") +
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "FEMMINE"), aes(yintercept = tasso_it), 
             color = "red") +
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +

  facet_wrap(~ANNO) +
  labs(
    title = "Tasso di ospedalizzazione per regione e sesso (per 1000 abitanti)",
    subtitle = "Lungodegenza",
    caption = "Source: Ministero della Salute"
  )
p 


```


Table 6.1.3 shows the hospitalization rate for each region, by gender and year, for the activity *Lungodegenza*.


```{r, echo=FALSE, include=TRUE}

HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Lungodegenza") %>%
  dplyr::group_by(ANNO)  %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), as.numeric) %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), round, digits = 3) %>% 
  dplyr::rename(`Tasso osp. Maschi` = "MASCHI",
                `Tasso osp. Femmine` = "FEMMINE") %>%
  dplyr::select(1:3, 5) %>%
  
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 6.1.3"
  )

```


# CONFRONTO TASSI OSPEDALIZZAZIONE: ITALIA vs UNITED KINGDOM

This section gives an overview of the Italian and English population in 2019, then an analysis in UK of the total number of surgeries (that can be compared to the total number of the italian *dimissioni*) and surgical incidences (the italian **tasso di ospedalizzazione**) is made. Lastly, It shows a comparison between the overall hospitalization rates in Italy and UK.

## Popolazione: Italia vs Regno Unito

This first part shows the difference between United Kingdom and Italian population in 2019, considering age category and gender. Data about population are provided by [**Istat**](http://dati.istat.it/Index.aspx?DataSetCode=DCIS_POPRES1) for Italy and [**UK Office for National Statistics**](https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/populationestimates/bulletins/annualmidyearpopulationestimates/latest#ageing) for United Kingdom.


```{r, echo=FALSE, include=TRUE}

ggplot(data = pop_ita2019, 
       mapping = aes(x = ifelse(test = Sesso == "maschi", yes = -Value, no = Value), 
                     y = `Categoria_età` , fill = Sesso)) +
  geom_col() +
  scale_x_symmetric(labels = abs) +  #from lemon package
  labs( title = "Piramide popolazione",
        subtitle = "Italia, 2019",
       x = "POPOLAZIONE",
       y = "ETÀ",
       caption = "Source: Istat"
       )


```

Table 3.1.1 summarises the data about the italian population in 2019, by age category and gender. The total population is 59.816.673, where 29.131.195 are male and 30.685.478 female.
```{r, echo=FALSE, include=TRUE}

pop_ita2019 %>%
  dplyr::select(-stato_civile) %>%
  dplyr::rename(Popolazione = "Value") %>%
  dplyr::relocate(`Età`, Popolazione, Sesso, `Categoria_età`, Anno) %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 3.1.1')

```


```{r, echo=FALSE, include=TRUE}

ggplot(data = uk_pop2019, 
       mapping = aes(x = ifelse(test = Sesso == "maschi", 
                                yes = -popolazione,
                                no = popolazione), 
                     y = `Categoria_età` , fill = Sesso)) +
  geom_col() +
  scale_x_symmetric(labels = abs) +
  labs( title = "Piramide popolazione",
        subtitle = "Regno Unito, 2019",
        x = "POPOLAZIONE",
        y = "ETÀ",
        caption = "Source: UK Office for National Statistics"
  )



```


Table 3.1.2 summarises the data about the United Kingdom population in 2019, by age category and gender. The total population is 66.796.807, where 32.978.229 are male and 33.818.578 female.
```{r, echo=FALSE, include=TRUE}

uk_pop2019 %>%
  dplyr::mutate(Anno = "2019") %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 3.1.2')

```


## Numero di interventi e tassi di ospedalizzazione UK per categoria di età.

The data collected for UK about hospitalization rate consider two main activities, **In-patient surgeries** and **Out-patient surgeries**. The difference between the two is that the first one requires overnight hospitalization, while patients receiving out-patient care don’t need to spend a night in a hospital. These two activities can be compared respectively to the italian [**Ricovero Ordinario**](#glossario) and [**Day-hospital**](#glossario).


The following graph shows the total number of surgeries in England (In-patient Out-patient) by age category and gender.
```{r, echo=FALSE, include=TRUE}

UK_surgery_M <- UK_surgery %>%
  dplyr::select(1,2) %>%
  dplyr::rename(`Number of Surgeries` = "MALE") %>%
  dplyr::mutate_at(vars(`Number of Surgeries`), as.numeric) %>%
  dplyr::mutate_at(vars(`Number of Surgeries`), round) %>%
  dplyr::mutate(GENDER = "Male")


UK_surgery_F <- UK_surgery %>%
  dplyr::select(1,3) %>%
  dplyr::rename(`Number of Surgeries` = "FEMALE") %>%
  dplyr::mutate_at(vars(`Number of Surgeries`), as.numeric) %>%
  dplyr::mutate_at(vars(`Number of Surgeries`), round) %>%
  dplyr::mutate(GENDER = "Female")

UK_sur_tot <- dplyr::bind_rows(UK_surgery_M, UK_surgery_F) %>%
   dplyr::filter(`AGE CATEGORY` != "Total") %>%
  dplyr::mutate_at(vars(`AGE CATEGORY`), factor)

UK_sur_tot$`AGE CATEGORY` <- factor(UK_sur_tot$`AGE CATEGORY`,
                                           c("0 - 4 Years", "5 - 9 Years",
                                           "10 - 14 Years", "15 - 19 Years", 
                                           "20 - 24 Years","25 - 29 Years",
                                           "30 - 34 Years", "35 - 39 Years",
                                           "40 - 44 Years", "45 - 49 Years", 
                                           "50 - 54 Years", "55 - 59 Years",
                                           "60 - 64 Years","65 - 69 Years", 
                                           "70 - 74 Years","75 - 79 Years",
                                           "80 - 84 Years", "85  &  over"))

UK_sur_tot %>%
  ggplot(aes(x = `AGE CATEGORY`, y = `Number of Surgeries`, fill = GENDER)) + 
  
  geom_bar(stat = "identity", position = "dodge") +
  
 theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "NUMBER OF SURGERIES (by age and gender)",
              subtitle = "England, 2019",
       caption = "Source: UK Office for National Statistics") +
    ylab(" ") + 
        xlab("AGE CATEGORY")


```


Table 3.1.3 summarises the data of the graph above. 

```{r, echo=FALSE, include=TRUE}

UK_sur_tot %>%
   DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 3.1.3"
  )


```





The following graph shows the the hospitalization rate in UK for age category and gender, considering both In-patients and out-patients surgeries.

```{r, echo=FALSE, include=TRUE}

Eng_sur_inc_M <- England_sur_incidence %>%
  dplyr::select(1,2) %>%
  dplyr::rename(Incidence = "MALE") %>%
  dplyr::mutate(GENDER = "Male")

Eng_sur_inc_F <- England_sur_incidence %>%
  dplyr::select(1,3) %>%
  dplyr::rename(Incidence = "FEMALE") %>%
  dplyr::mutate(GENDER = "Female")


England_incidence <- dplyr::bind_rows(Eng_sur_inc_M, Eng_sur_inc_F) %>%
  dplyr::filter(`AGE CATEGORY` != "Total") %>%
  dplyr::mutate_at(vars(`AGE CATEGORY`), factor)

England_incidence$`AGE CATEGORY` <- factor(England_incidence$`AGE CATEGORY`,
                                           c("0 - 4 Years", "5 - 9 Years",
                                           "10 - 14 Years", "15 - 19 Years", 
                                           "20 - 24 Years","25 - 29 Years",
                                           "30 - 34 Years", "35 - 39 Years",
                                           "40 - 44 Years", "45 - 49 Years", 
                                           "50 - 54 Years", "55 - 59 Years",
                                           "60 - 64 Years","65 - 69 Years", 
                                           "70 - 74 Years","75 - 79 Years",
                                           "80 - 84 Years", "85  &  over"))






England_incidence %>%  
  ggplot(aes(x = `AGE CATEGORY`, y = Incidence, fill = GENDER)) + 
  
  geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "SURGICAL INCIDENCES (by age and gender)",
              subtitle = "England, 2019",
       caption = "Source: UK Office for National Statistics") +
    ylab(" ") + 
        xlab("AGE CATEGORY")

```

Table 3.1.4 shows the data about surgical incidences represented in the graph above

```{r, echo=FALSE, include=TRUE}

England_incidence %>%
  dplyr::mutate_at(vars(Incidence), round, digits = 3) %>%
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 3.1.4"
  )

```


## Tassi di ospedalizzazione: Regno Unito vs Italia

The following graph provides an overview of the differences in between the hospitalization rate in England and in Italy by age. The first thing noticed is that the female hospitalization rate is higher in both England and Italy.
In addition, the incidence is higher in England for both gender, especially for female.


```{r, echo=FALSE, include=TRUE}

ita2019_M<- pop_ita2019  %>%
  filter(Sesso == "maschi") %>%
  pull(Value) %>%
  sum()

ita2019_F <- pop_ita2019  %>%
  filter(Sesso == "femmine") %>%
  pull(Value) %>%
  sum()

dimissioni_M_19 <- sdo_age_gender %>%
  filter(ANNO == "2019")  %>%
  pull(MASCHI) %>%
  sum()

dimissioni_F_19 <- sdo_age_gender %>%
  filter(ANNO == "2019")  %>%
  pull(FEMMINE) %>%
  sum()

incidence_England_tot <- England_sur_incidence %>%
  dplyr::filter(`AGE CATEGORY` == "Total")

incidence_it_en <- tibble(Incidence = c(dimissioni_M_19/ita2019_M,
                                        dimissioni_F_19/ita2019_F,
                                        incidence_England_tot$MALE,
                                        incidence_England_tot$FEMALE),
                          Gender = c("Male", "Female",
                                     "Male", "Female"),
                          Country = c("Italy", "Italy",
                                      "England", "England"))

incidence_it_en %>%
  ggplot(aes(x = Country, y = Incidence, fill = Gender)) +
geom_bar(stat = "identity", position = "dodge")




```
 
Table 3.1.3 shows the data about hospitalization rate represented in the bar chart above.

```{r, echo=FALSE, include=TRUE}

incidence_it_en %>%
  dplyr::mutate_at(vars(Incidence), round, digits = 3) %>%
   DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 3.1.3"
  )



```



# CONFRONTO DATI DIMISSIONI OSPEDALIERE: ISTAT VS MINISTERO DELLA SALUTE

The following section provides a comparison between the data about hospitalization discharges collected from two different sources: Istat and Italian Ministry of Health.

Istat provided data just for the activity *Acuti*, distinguishing between *"Ordinario"* and *"Day-Hospital"*, that are respectively given by *Acuti - Regime ordinario* and *Acuti - Regime diurno* from Ministry of Health.

```{r, echo=FALSE, include=TRUE}

istat_tot_dism <- istat_discharge %>% 
  dplyr::filter(`REGIME DI RICOVERO` != "totale",
         GENERE == "totale",
         `AREA DI CITTADINANZA` == "Mondo",
         `CLASSE DI ETÀ` != "totale") %>%
  dplyr::group_by(`REGIME DI RICOVERO`) %>%
  dplyr::rename(`attività` = `REGIME DI RICOVERO`) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate(`attività` = c("Acuti - Regime diurno",
                                         "Acuti - Regime ordinario")) %>%
  dplyr::mutate(Source = "Istat")

sum_ordinario_19 <- summary_ordinario %>%
  dplyr::filter(ANNO == "2019") %>%
  dplyr::mutate(`attività` = "Acuti - Regime ordinario") %>%
  dplyr::select(-`VARIAZIONE %`)

sum_diurno_19 <- summary_diurno %>%
  dplyr::filter(ANNO == "2019") %>%
  dplyr::select(-(3)) %>% 
  mutate(`attività` = "Acuti - Regime diurno")

summary_tot <- dplyr::bind_rows(sum_ordinario_19, sum_diurno_19) %>%
  dplyr::select(-ANNO) %>%
  dplyr::mutate(Source = "Ministero della Salute") %>%
  dplyr::relocate(`attività`, DIMISSIONI, Source)

summary_plotted <- dplyr::bind_rows(summary_tot, istat_tot_dism) 

summary_plotted %>%
  DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 3.1.3')

```
As shown by the table above, there is a slight difference in the data provided by the two sources for both *Regime ordinario* and *Regime diurno*.


## Istat, Acuti - Regime ordinario

This part focuses on the analysis of hospitalization discharges for the activity *"Acuti - Regime ordinario"* considering data provided by istat.
In the data provided by istat, the age categories are a very limited number compared to the ones of Italian Ministry. This is shown in the graph below.

```{r, echo=FALSE, include=TRUE}

istat_byage <- istat_discharge %>% 
  filter(`REGIME DI RICOVERO` == "ordinario",
         GENERE == "totale",
         `AREA DI CITTADINANZA` == "Mondo",
         `CLASSE DI ETÀ` != "totale" ) %>%
  dplyr::mutate_at(vars(`CLASSE DI ETÀ`), factor)

istat_byage$`CLASSE DI ETÀ` <- factor(istat_byage$`CLASSE DI ETÀ`,
                                          c("fino a 17 anni",
                                            "18-24 anni",
                                            "25-44 anni",
                                            "45-64 anni",
                                            "65 anni e più",
                                            "non indicato"
                                            ))
istat_byage %>%
 
  ggplot(., aes(x = `CLASSE DI ETÀ`,y = DIMISSIONI, fill = `CLASSE DI ETÀ` )) +
  geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER ETÀ (Acuti - Regime ordinario)",
       subtitle = "Italia, 2019",
       caption = "Source: Istat")

  


```

Table 3.1.4 provides a summary of the hospitalization discharges by age category in 2019 in Italy. 

```{r, echo=FALSE, include=TRUE}

istat_byage %>%
  dplyr::select(-c(2,4,5)) %>%
  dplyr::mutate(`REGIME DI RICOVERO` = "Acuti - Regime ordinario") %>%
  DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 3.1.4')


```



Data provided by Istat consider the distinction between hospitalization discharges by gender, as well as data provided by Italian Ministry of Health.
As shown by the graph below, the numbers are slightly different due to the fact that the Italian Ministry data, in distinguishing between male and female, does not consider discharges where age or gender were not well specified


```{r, echo=FALSE, include=TRUE}

istat_gender <- istat_discharge %>% 
  filter(`REGIME DI RICOVERO` == "ordinario",
         GENERE != "totale",
         `AREA DI CITTADINANZA` == "Mondo",
         `CLASSE DI ETÀ` != "totale" & `CLASSE DI ETÀ` != "non indicato") %>%
  group_by(GENERE) %>%
  summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate(Source = "Istat")
   

MM <- sdo_age_gender %>%
  filter(`ATTIVITÀ` == "Acuti - Regime ordinario",
         ANNO == "2019") %>%
  pull(MASCHI) %>%
  sum()

FF <- sdo_age_gender %>%
  filter(`ATTIVITÀ` == "Acuti - Regime ordinario",
         ANNO == "2019") %>%
  pull(FEMMINE) %>%
  sum()

sdo_gen <- tibble(GENERE = c("maschi", "femmine"), DIMISSIONI = c(MM,FF)) %>%
  dplyr::mutate(Source = "Ministero della Salute")


gender_plot <- dplyr::bind_rows(sdo_gen, istat_gender)

gender_plot %>%
  ggplot( aes(x = GENERE, 
             y = DIMISSIONI,
             fill = Source)) +
  geom_bar( stat = "identity",
            position = "dodge") + 
  labs(title = "DIMISSIONI PER GENERE",
       subtitle = "Istat vs Ministero della Salute, Italia 2019")


```

An important difference in data provided by istat is the distinction between country of origin of the patient, as shown in the graph below.

```{r, echo=FALSE, include=TRUE}

istat_country<- istat_discharge %>% 
  dplyr::filter(`REGIME DI RICOVERO` == "ordinario",
         GENERE == "totale",
         `AREA DI CITTADINANZA` %in% c("Europa", "Asia", "Africa", "America", 
                                       "Oceania", "Apolide", "Unknown")) %>%
  dplyr::filter(`CLASSE DI ETÀ` != "totale" 
                & `CLASSE DI ETÀ` != "non indicato") %>%
  dplyr::mutate(`REGIME DI RICOVERO` = "Acuti - Regime ordinario")

p <- ggplot(istat_country,
            aes(x = `CLASSE DI ETÀ`,
                y = DIMISSIONI,
                fill = `AREA DI CITTADINANZA`)) + 
  geom_bar(stat = "identity", position = "fill") +
  labs(title = "DIMISSIONI REGIME ORDINARIO PER AREA ED ETÀ",
  subtitle = "Italia, 2019",
  caption = "Source: Istat")
p
```


The pie chart below shows the geographical area of the patient without discriminate by age category. As shown, the discharges of people from *Oceania* and people that are stateless (*Apolide*) are negligible. The most important proportion of the table is, of course, by patients of Europe. This is due to the fact that the number of discharges of Italian people is the highest, namely 5.615.223.

```{r, echo=FALSE, include=TRUE}

istat_country_pie<- istat_discharge %>% 
  dplyr::filter(`REGIME DI RICOVERO` == "ordinario",
         GENERE == "totale",
         `AREA DI CITTADINANZA` %in% c("Europa", "Asia", "Africa", "America", 
                                       "Oceania", "Apolide", "Unknown")) %>%
  dplyr::filter(`CLASSE DI ETÀ` == "totale" 
                & `CLASSE DI ETÀ` != "non indicato") %>%
  dplyr::mutate(`REGIME DI RICOVERO` = "Acuti - Regime ordinario") %>%
  dplyr::mutate(PERCENTUALE = DIMISSIONI / sum(DIMISSIONI))

p <- ggplot(istat_country_pie, aes(x = " ", y = PERCENTUALE,
                                   fill = `AREA DI CITTADINANZA`)) + 
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start=0)
p
```




The following table summarises the data shown in the graphs above.
```{r, echo=FALSE, include=TRUE}
istat_country %>%
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 3.1.5"
  )

```

## Istat, Acuti - Regime diurno
This second part is concerned to the analysis of hospitalization discharges for the activity *"Acuti - Regime diurno"* considering data provided by istat.

This first graph shows the hospitalization discharges taking into account the different age category.

```{r, echo=FALSE, include=TRUE}

istat_byage_d <- istat_discharge %>% 
  filter(`REGIME DI RICOVERO` == "day-hospital",
         GENERE == "totale",
         `AREA DI CITTADINANZA` == "Mondo",
         `CLASSE DI ETÀ` != "totale" ) %>%
  dplyr::mutate_at(vars(`CLASSE DI ETÀ`), factor)

istat_byage$`CLASSE DI ETÀ` <- factor(istat_byage$`CLASSE DI ETÀ`,
                                          c("fino a 17 anni",
                                            "18-24 anni",
                                            "25-44 anni",
                                            "45-64 anni",
                                            "65 anni e più",
                                            "non indicato"
                                            ))
istat_byage_d %>%
 
  ggplot(., aes(x = `CLASSE DI ETÀ`,y = DIMISSIONI, fill = `CLASSE DI ETÀ` )) +
  geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER ETÀ (Acuti - Regime diurno)",
       subtitle = "Italia, 2019",
       caption = "Source: Istat")

  


```

Table 3.1.6 provides a summary of the hospitalization discharges by age category in 2019 in Italy. 

```{r, echo=FALSE, include=TRUE}

istat_byage_d %>%
  dplyr::select(-c(2,4,5)) %>%
  dplyr::mutate(`REGIME DI RICOVERO` = "Acuti - Regime diurno") %>%
  DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 3.1.6')


```

Data provided by Istat consider the distinction between hospitalization discharges by gender, as well as data provided by Italian Ministry of Health.
Even in the case of *Acuti - Regime diurno* the numbers are slightly different due to the fact that the Italian Ministry data, in distinguishing between male and female, does not consider discharges where age or gender were not well specified.


```{r, echo=FALSE, include=TRUE}

istat_gender_d <- istat_discharge %>% 
  filter(`REGIME DI RICOVERO` == "day-hospital",
         GENERE != "totale",
         `AREA DI CITTADINANZA` == "Mondo",
         `CLASSE DI ETÀ` != "totale" & `CLASSE DI ETÀ` != "non indicato") %>%
  group_by(GENERE) %>%
  summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate(Source = "Istat")
   

MM <- sdo_age_gender %>%
  filter(`ATTIVITÀ` == "Acuti - Regime diurno",
         ANNO == "2019") %>%
  pull(MASCHI) %>%
  sum()

FF <- sdo_age_gender %>%
  filter(`ATTIVITÀ` == "Acuti - Regime diurno",
         ANNO == "2019") %>%
  pull(FEMMINE) %>%
  sum()

sdo_gen <- tibble(GENERE = c("maschi", "femmine"), DIMISSIONI = c(MM,FF)) %>%
  dplyr::mutate(Source = "Ministero della Salute")


gender_plot <- dplyr::bind_rows(sdo_gen, istat_gender_d)

gender_plot %>%
  ggplot( aes(x = GENERE, 
             y = DIMISSIONI,
             fill = Source)) +
  geom_bar( stat = "identity",
            position = "dodge") + 
  labs(title = "DIMISSIONI PER GENERE",
       subtitle = "Istat vs Ministero della Salute, Italia 2019")


```

An important difference in data provided by istat is the distinction between country of origin of the patient, as shown in the graph below.

```{r, echo=FALSE, include=TRUE}

istat_country_d<- istat_discharge %>% 
  dplyr::filter(`REGIME DI RICOVERO` == "day-hospital",
         GENERE == "totale",
         `AREA DI CITTADINANZA` %in% c("Europa", "Asia", "Africa", "America", 
                                       "Oceania", "Apolide", "Unknown")) %>%
  dplyr::filter(`CLASSE DI ETÀ` != "totale" 
                & `CLASSE DI ETÀ` != "non indicato") %>%
  dplyr::mutate(`REGIME DI RICOVERO` = "Acuti - Regime diurno")

p <- ggplot(istat_country_d,
            aes(x = `CLASSE DI ETÀ`,
                y = DIMISSIONI,
                fill = `AREA DI CITTADINANZA`)) + 
  geom_bar(stat = "identity", position = "fill") +
  labs(title = "DIMISSIONI REGIME DIURNO, PER AREA ED ETÀ",
  subtitle = "Italia, 2019",
  caption = "Source: Istat")
p
```


The pie chart below shows the geographical area of the patient without discriminate by age category for *Acuti - Regime diurno*. Even in this case, the discharges of people from *Oceania* and people that are stateless (*Apolide*) are negligible. The most important proportion of the table is, of course, by patients of Europe. This is due to the fact that the number of discharges of Italian people is the highest, that is 1.647.029.

```{r, echo=FALSE, include=TRUE}

istat_country_pie_d<- istat_discharge %>% 
  dplyr::filter(`REGIME DI RICOVERO` == "day-hospital",
         GENERE == "totale",
         `AREA DI CITTADINANZA` %in% c("Europa", "Asia", "Africa", "America", 
                                       "Oceania", "Apolide", "Unknown")) %>%
  dplyr::filter(`CLASSE DI ETÀ` == "totale" 
                & `CLASSE DI ETÀ` != "non indicato") %>%
  dplyr::mutate(`REGIME DI RICOVERO` = "Acuti - Regime diurno") %>%
  dplyr::mutate(PERCENTUALE = DIMISSIONI / sum(DIMISSIONI))

p <- ggplot(istat_country_pie_d, aes(x = " ", y = PERCENTUALE,
                                   fill = `AREA DI CITTADINANZA`)) + 
  geom_bar(width = 1, stat = "identity") +
  coord_polar("y", start=0)
p
```




The following table summarises the data shown in the graphs above.
```{r, echo=FALSE, include=TRUE}
istat_country_d %>%
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 3.1.7"
  )

```

\pagebreak

# GLOSSARIO {-}

**Accessi**: Presenza in ospedale senza pernottamento, per l’erogazione di prestazioni in regime di day hospital.

**Attività**: Tipologia di assistenza ospedaliera; comprende i ricoveri per acuti, quelli di riabilitazione e la lungodegenza.


**Day Hospital (diurno)**: caratterizzato dalle seguenti condizioni: si tratta di un ricovero o di un ciclo di ricoveri programmato; è limitato ad una sola parte della giornata e non prevede il pernottamento nella struttura; fornisce prestazioni multiprofessionali o plurispecialistiche che necessitano di un tempo di esecuzione che si discosta in modo netto da quello necessario
per una normale prestazione ambulatoriale.


**Giorno di Degenza**: Periodo di 24 ore durante il quale un posto letto è occupato.  

**MDC**: MAJOR DIAGNOSTIC CATEGORY (MDC),
Categoria diagnostica principale: il sistema DRG prevede un livello superiore di raggruppamento basato su un criterio di rilevanza clinica (anatomico o eziologico): in base alla diagnosi principale riportata nella Scheda di Dimissione Ospedaliera viene assegnata la categoria MDC; successivamente, viene attribuito uno specifico DRG fra quelli appartenenti alla MDC selezionata. 

**Ricoveri di Lungodegenza**: Sono i ricoveri di pazienti dimessi da reparti appartenenti alla disciplina LUNGODEGENTI (codice 60 nei
modelli di rilevazione del Sistema informativo sanitario). 

**Regime di ricovero**: Distingue tra il “RICOVERO ORDINARIO”, che prevede il pernottamento nella struttura ospedaliera, ed il “RICOVERO IN DAY HOSPITAL”, caratterizzato al contrario dalla presenza in ospedale solo per una 
parte della giornata.

**Ricoveri per Acuti**: Sono tutti i casi dimessi da reparti diversi da quelli classificati come riabilitativi o di lungodegenza; sono esclusi, inoltre, i neonati sani. 

**Ricoveri di Riabilitazione**: Sono identificati come ricoveri di riabilitazione sia i ricoveri di pazienti dimessi da reparti appartenenti alle discipline UNITA’ SPINALE (codice 28 nei modelli di rilevazione del Sistema informativo sanitario),RECUPERO E RIABILITAZIONE FUNZIONALE (codice 56), NEURORIABILITAZIONE (codice 75), sia i ricoveri effettuati in istituti di sola riabilitazione (esclusa la LUNGODEGENZA, codice disciplina 60). 

**Ricoveri di Lungodegenza**: Sono i ricoveri di pazienti dimessi da reparti appartenenti alla disciplina LUNGODEGENTI (codice 60 nei modelli di rilevazione del Sistema informativo sanitario). 

**Ricovero Ordinario**: prevede l’assegnazione di un posto letto e la permanenza del paziente continuativa con pernottamento nella struttura ospedaliera.


**Tasso di ospedalizzazione**: Il tasso di ospedalizzazione fornisce una
misura sintetica sul ricorso al ricovero ospedaliero della popolazione oggetto di studio. Si calcola come rapporto fra numero di ricoveri ospedalieri, ovunque
effettuati, relativi a soggetti residenti in una data regione e la complessiva popolazione ivi residente.


