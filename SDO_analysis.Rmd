---
title: "SDO analysis"
author: "Marco Gaudio"
date: "2/3/2021"
output:
  html_document:
    code_folding: show
    highlight: tango
    keep_md: no
    number_sections: yes
    theme: united
    toc: yes
    toc_float: yes
  word_document:
    toc: yes
  pdf_document:
    toc: yes
  github_document:
    toc: yes
---

```{r, include=FALSE}
options(scipen=999)
knitr::opts_chunk$set(echo = TRUE, 
                      include = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      comment = FALSE)
library(tidymodels)
library(tidyverse)
library(palmerpenguins)
library(kableExtra)
library(DT)
```


The aim of this document is to analyze the datas related to the italian *Schede Dimissioni Ospedaliere* (SDO), in the period 2016 - 2019. 
The data are provided by the [**Italian Ministry of Health**](http://www.salute.gov.it/portale/temi/p2_6.jsp?lingua=italiano&id=1237&area=ricoveriOspedalieri&menu=vuotolink).

The document is composed by 3 sections: 

* **section 1** provides an analysis for each of the 5 activities (Acuti Regime ordinario;       Acuti Regime diurno, Riabilitazione Regime ordinario; Riabilitazione Regime diurno;        Lungodegenza) and considering the differences in the period studied. 

* **section 2** analyses the hospitalization rates, first providing an overview for Italy as a whole, and then analysing the rates for each of the 5 activities in in the period 2016-2019, considering different region, gender and age category.

* **section 3** provides a comparison between  hospitalization rates in Italy and hospitalization rates in UK.


```{r}
# construct a summary table
summary_ordinario <- matching_tables %>% 
  group_by(ANNO) %>%
  summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3)) %>%
  mutate(`ATTIVITÀ` = "Acuti - Regime ordinario")

summary_diurno <- matching_tables_2.2.11 %>% 
  group_by(ANNO) %>%
  summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3)) %>%
  mutate(`ATTIVITÀ` = "Acuti - Regime diurno")

summary_riab_ord <- SDO_ordinario_riab %>%
  group_by(ANNO) %>%
  summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3)) %>%
  mutate(`ATTIVITÀ` = "Riabilitazione - Regime ordinario")

summary_riab_diurno <- SDO_diurno_riab %>%
  group_by(ANNO) %>%
  summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3)) %>%
  mutate(`ATTIVITÀ` = "Riabilitazione - Regime diurno")

summary_lungodegenza <- SDO_lungodegenza %>%
  group_by(ANNO) %>%
  summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3)) %>%
  mutate(`ATTIVITÀ` = "Riabilitazione - Regime diurno")

summary_tab <- dplyr::bind_rows(summary_ordinario,
                                summary_diurno,
                                summary_riab_ord,
                                summary_riab_diurno,
                                summary_lungodegenza)

```


### An overview of hospitalization discharges in Italy {-}
The following graph shows the total number of hospital discharges divided by activity for the 4 years of analysis.

```{r, echo=FALSE, include=TRUE}

  p <- ggplot(summary_tab, aes(x = ANNO, y = DIMISSIONI, fill = `ATTIVITÀ`)) + 
  geom_bar(stat = "identity") +
  labs(title = "DIMISSIONI TOTALI PER ATTIVITÀ",
  subtitle = "Italia")
p
```

Table 1.1.1 shows the total number of discharges for all the activities and its percentage variation through the period of analysis. As shown here, the total number of hospital discharges is decreased from 2016 to 2019. In particular, from 2018 to 2019 the number has dropped from 8.522.456 to 8.356.874, with a decrease of 1.733%.

```{r, echo=FALSE, include=TRUE}

summary_tab %>% 
  dplyr::group_by(ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100,
                                        digits = 3)) %>%
DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 1.1.1')

```



# ATTIVITÀ

## Acuti - Regime ordinario.
the following section is aimed to analyze the discharge in *Acuti - Regime ordinario*, from 2016 to 2019 in Italy.

### DIMISSIONI

Table 1.1.2 provides a summary of the hospedalization discharges in *"Acuti - Regime ordinario"* and the variation from year to year.

```{r, echo=FALSE, include=TRUE}
summary_ordinario <- matching_tables %>% 
  dplyr::group_by(ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3))

summary_ordinario %>% 
  DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 1.1.2')



```

This bar chart shows the hospital discharges by [MDC](#glossario) for each year of the analysis.
```{r, echo=FALSE, include=TRUE}

SDO_ordinario %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = DIMISSIONI,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER MDC",
              subtitle = "Acuti - Regime ordinario")

  
```

As shown from the bar chart, over the 4 years of analysis, the MDC class with the greatest number of dicharges for the activity *Acuti - Regime ordinario* is the **MDC 05 - Malattie e disturbi dell'apparato cardiocircolatorio**, followed by **MDC 08 - Malattie e disturbi del sistema muscolo-scheletrico e del tessuto connettivo** and **MDC 04 - Malattie e disturbi dell'apparato respiratorio**.  



The following table provides a summary of the discharges for each MDC class and for each year.

```{r, echo=FALSE, include=TRUE}
#overall discharges for acuti - regime ordinario for the 4 years
overall_ordinario <- matching_tables %>%
  dplyr::select(CLASSE_MDC, DIMISSIONI, ANNO)

overall_ordinario %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.1.3')
```

### PERCENTUALE GIORNI DIMISSIONI PER MDC.

Thwe following pie charts show the percentage of days before discharge per the 4 years analysed.


```{r, echo=FALSE, include=TRUE}

percentage_tab <- function(year){
  perc <- SDO_ordinario %>%
  filter(ANNO == year) %>%
  mutate(percentage_dim1gg = `% DIMISSIONI DI 1 GIORNO`/100,
         percentage_dim2gg = `% DIMISSIONI DI 2-3 GIORNI`/100,
         percentage_dim4gg = `% DIMISSIONI TRA 4 GIORNI E VALORE SOGLIA`/100,
         percentage_dimooltre = `% DIMISSIONI OLTRE VALORE SOGLIA`/100) 
# compute the percentage for the whole MDC

dimissioni <- as.matrix(perc$DIMISSIONI, ncol = 1)  
percent_oneday <-  as.matrix(perc$percentage_dim1gg, nrow = 1) 
percent_twoday <- as.matrix(perc$percentage_dim2gg, nrow = 1)
percent_fourday <- as.matrix(perc$percentage_dim4gg, nrow = 1)
percentbeyond <- as.matrix(perc$percentage_dimooltre, nrow = 1)

dimissioni_1 <- round((t(percent_oneday) %*% dimissioni )/ sum(perc$DIMISSIONI), digits = 3)
dimissioni_2 <- round((t(percent_twoday) %*% dimissioni )/ sum(perc$DIMISSIONI), digits = 3)
dimissioni_4 <- round((t(percent_fourday) %*% dimissioni )/ sum(perc$DIMISSIONI), digits = 3)
dimissioni_oltre <- round((t(percentbeyond) %*% dimissioni )/ sum(perc$DIMISSIONI), 
                          digits = 3)
return(c(dimissioni_1,dimissioni_2, dimissioni_4, dimissioni_oltre))
}
perc <- SDO_ordinario %>%
  filter(ANNO == "2019") %>%
  mutate(percentage_dim1gg = `% DIMISSIONI DI 1 GIORNO`/100,
         percentage_dim2gg = `% DIMISSIONI DI 2-3 GIORNI`/100,
         percentage_dim4gg = `% DIMISSIONI TRA 4 GIORNI E VALORE SOGLIA`/100,
         percentage_dimooltre = `% DIMISSIONI OLTRE VALORE SOGLIA`/100) 
# compute the percentage for the whole MDC

dimissioni <- as.matrix(perc$DIMISSIONI, ncol = 1)  
percent_oneday <-  as.matrix(perc$percentage_dim1gg, nrow = 1) 
percent_twoday <- as.matrix(perc$percentage_dim2gg, nrow = 1)
percent_fourday <- as.matrix(perc$percentage_dim4gg, nrow = 1)
percentbeyond <- as.matrix(perc$percentage_dimooltre, nrow = 1)

dimissioni_1 <- round((t(percent_oneday) %*% dimissioni )/ sum(perc$DIMISSIONI), digits = 3)
dimissioni_2 <- round((t(percent_twoday) %*% dimissioni )/ sum(perc$DIMISSIONI), digits = 3)
dimissioni_4 <- round((t(percent_fourday) %*% dimissioni )/ sum(perc$DIMISSIONI), digits = 3)
dimissioni_oltre <- round((t(percentbeyond) %*% dimissioni )/ sum(perc$DIMISSIONI), 
                          digits = 3)


mycols <- c("% DIMISSIONI DI 1 GIORNO",                 
            "% DIMISSIONI DI 2-3 GIORNI",              
            "% DIMISSIONI TRA 4 GIORNI E VALORE SOGLIA",
            "% DIMISSIONI OLTRE VALORE SOGLIA")

prop_table <- function(year){
  discharges_prop <- percentage_tab(year)
tabella_plot <- tidyr::tibble(class = mycols,
                       proportion = discharges_prop) %>%
  dplyr::arrange(-proportion) %>%
  dplyr::mutate(Per_cumsum = cumsum(proportion)) %>%
  dplyr::mutate(ANNO = year)

}
Years <- c("2016", "2017", "2018", "2019")

summary_list <- purrr::map(Years, prop_table)

summary_prop <- dplyr::bind_rows(summary_list) 

discharges_2019 <- percentage_tab("2019")
tabella_plot_2019 <- tibble(class = mycols,
                       proportion = discharges_2019) %>%
  arrange(-proportion) %>%
  mutate(Per_cumsum = cumsum(proportion))


ggplot(data = summary_prop, aes(x=1, y=proportion, fill=class)) +
  geom_col() +
  geom_text(aes(label = proportion*100), position = position_stack(vjust = 0.5))+
  coord_polar(theta = "y") + 
  theme_void() +
  labs(title = "% DIMISSIONI PER GIORNO",
       subtitle = "Acuti - Regime ordinario",
       fill = "") +
  facet_wrap(~ANNO)



```






The bar chart below shows the distribution of discharges in *Acuti - Regime ordinario* per age category, for each year of analysis.

```{r, echo=FALSE, include=TRUE}

sdo_age_gender2 <- sdo_age_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti - Regime ordinario") %>%
  dplyr::mutate_at(vars(`Categoria età`), factor)

sdo_age_gender2$`Categoria età` <- factor(sdo_age_gender2$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 9 anni",
                                            "Da 10 a 14 anni",
                                            "Da 15 a 19 anni",
                                            "Da 20 a 24 anni",
                                            "Da 25 a 29 anni", 
                                            "Da 30 a 34 anni", 
                                            "Da 35 a 39 anni",
                                            "Da 40 a 44 anni",
                                            "Da 45 a 49 anni", 
                                            "Da 50 a 54 anni", 
                                            "Da 55 a 59 anni", 
                                            "Da 60 a 64 anni", 
                                            "Da 65 a 69 anni", 
                                            "Da 70 a 74 anni",
                                            "75 anni e oltre"))
sdo_age_gender2 %>%
  dplyr::select(`Categoria età`, MASCHI, FEMMINE, ANNO) %>%
  dplyr::mutate(DIMISSIONI_TOT = MASCHI + FEMMINE) %>%
  dplyr::select(`Categoria età`, DIMISSIONI_TOT, ANNO) %>%
 
  ggplot(., aes(x = `Categoria età`,y = DIMISSIONI_TOT, fill = ANNO)) +
  geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5))

  
  




```




### GIORNATE DI DEGENZA {.tabset}

The following graph shows the [*Giorni di Degenza*](#glossario) for each MDC and over the years of analysis.
```{r, echo=FALSE, include=TRUE}
SDO_ordinario %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(GIORNI_DEGENZA = sum(`GIORNI DI DEGENZA`)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = GIORNI_DEGENZA,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "GIORNI DI DEGENZA",
              subtitle = "Acuti - Regime ordinario")


```


Table 1.1.4 provides a summary for *Giorni di Degenza* by MDC for each year.

```{r, echo=FALSE, include=TRUE}
overall_ordinario_degenza <- matching_tables %>%
  dplyr::select(CLASSE_MDC, `GIORNATE DI DEGENZA`, ANNO)

overall_ordinario_degenza %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 1.1.4"
                )

```

The following graph shows the Mean value for *Giorni di Degenza* for each MDC.

#### 2019 {-}
```{r, echo=FALSE, include=TRUE}
sum_deg <- SDO_ordinario %>%
  dplyr::filter(ANNO == "2019") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_DEGENZA = max(`Degenza massima`),
            MIN_DEGENZA = min(`Degenza minima`),
            MEAN_DEGENZA = round(mean(`DEGENZA MEDIA (giorni)`), digits = 3))

ggplot(data = sum_deg, mapping = aes(x = forcats::fct_reorder(CLASSE_MDC,
                                                             MEAN_DEGENZA), 
                                     y = MEAN_DEGENZA)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Acuti - Regime ordinario",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  


```

#### 2018 {-}
```{r, echo=FALSE, include=TRUE}

sum_deg <- SDO_ordinario %>%
  dplyr::filter(ANNO == "2018") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_DEGENZA = max(`Degenza massima`),
            MIN_DEGENZA = min(`Degenza minima`),
            MEAN_DEGENZA = round(mean(`DEGENZA MEDIA (giorni)`), digits = 3))

ggplot(data = sum_deg, mapping = aes(x = forcats::fct_reorder(CLASSE_MDC,
                                                             MEAN_DEGENZA), 
                                     y = MEAN_DEGENZA)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Acuti - Regime ordinario",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  


```

#### 2017 {-}
```{r, echo=FALSE, include=TRUE}
sum_deg <- SDO_ordinario %>%
  dplyr::filter(ANNO == "2017") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_DEGENZA = max(`Degenza massima`),
            MIN_DEGENZA = min(`Degenza minima`),
            MEAN_DEGENZA = round(mean(`DEGENZA MEDIA (giorni)`), digits = 3))

ggplot(data = sum_deg, mapping = aes(x = forcats::fct_reorder(CLASSE_MDC,
                                                             MEAN_DEGENZA), 
                                     y = MEAN_DEGENZA)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Acuti - Regime ordinario",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  


```


#### 2016 {-}
```{r, echo=FALSE, include=TRUE}
sum_deg <- SDO_ordinario %>%
  dplyr::filter(ANNO == "2016") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_DEGENZA = max(`Degenza massima`),
            MIN_DEGENZA = min(`Degenza minima`),
            MEAN_DEGENZA = round(mean(`DEGENZA MEDIA (giorni)`), digits = 3))

ggplot(data = sum_deg, mapping = aes(x = forcats::fct_reorder(CLASSE_MDC,
                                                             MEAN_DEGENZA), 
                                     y = MEAN_DEGENZA)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Acuti - Regime ordinario",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  


```

### {-}

Table 1.1.5 provides a summary of Max, Min and Mean values for *"Giorni di Degenza"* for each MDC.
```{r, echo=FALSE, include=TRUE}

SDO_ordinario %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_DEGENZA = max(`Degenza massima`),
            MIN_DEGENZA = min(`Degenza minima`),
            MEAN_DEGENZA = round(mean(`DEGENZA MEDIA (giorni)`), digits = 3)) %>%
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.1.5'
    
  )

```



## Acuti - Regime diurno.

### DIMISSIONI

Table 1.2.1 provides a summary of the hospedalization discharges in *"Acuti - Regime diurno"* and the variation from year to year.


```{r, echo=FALSE, include=TRUE}
summary_diurno <- matching_tables_2.2.11 %>% 
  dplyr::group_by(ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3))

summary_diurno %>% 
  DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 1.2.1')



```


This bar chart shows the hospital discharges by MDC for each year of the analysis.
```{r, echo=FALSE, include=TRUE}

SDO_diurno %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = DIMISSIONI,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER MDC",
              subtitle = "Acuti - Regime diurno")

  
```


In the case of *Acuti - Regime diurno*, over the 4 years of analysis, the MDC class with the greatest number of dicharges is the **MDC 08 - Malattie e disturbi del sistema muscolo-scheletrico e del tessuto connettivo**, followed by **MDC 17 - Malattie e disturbi mieloproliferativi e neoplasie scarsamente differenziate** and **MDC 13 -Malattie e disturbi dell'apparato riproduttivo femminile**.  


The following table provides a summary of the discharges for each MDC class and for each year.

```{r, echo=FALSE, include=TRUE}
#overall discharges for acuti - regime diurno for the 4 years
overall_diurno <- matching_tables_2.2.11 %>%
  dplyr::select(CLASSE_MDC, DIMISSIONI, ANNO)

overall_diurno %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.2.2')
```

The bar chart below shows the distribution of discharges in *Acuti - Regime diurno* per age category, for each year of analysis.

```{r, echo=FALSE, include=TRUE}

sdo_age_gender2 <- sdo_age_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti - Regime diurno") %>%
  dplyr::mutate_at(vars(`Categoria età`), factor)

sdo_age_gender2$`Categoria età` <- factor(sdo_age_gender2$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 9 anni",
                                            "Da 10 a 14 anni",
                                            "Da 15 a 19 anni",
                                            "Da 20 a 24 anni",
                                            "Da 25 a 29 anni", 
                                            "Da 30 a 34 anni", 
                                            "Da 35 a 39 anni",
                                            "Da 40 a 44 anni",
                                            "Da 45 a 49 anni", 
                                            "Da 50 a 54 anni", 
                                            "Da 55 a 59 anni", 
                                            "Da 60 a 64 anni", 
                                            "Da 65 a 69 anni", 
                                            "Da 70 a 74 anni",
                                            "75 anni e oltre"))
sdo_age_gender2 %>%
  dplyr::select(`Categoria età`, MASCHI, FEMMINE, ANNO) %>%
  dplyr::mutate(DIMISSIONI_TOT = MASCHI + FEMMINE) %>%
  dplyr::select(`Categoria età`, DIMISSIONI_TOT, ANNO) %>%
 
  ggplot(., aes(x = `Categoria età`,y = DIMISSIONI_TOT, fill = ANNO)) +
  geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5))

  
  




```

### ACCESSI {.tabset}

The following graph shows the [*Accessi*](#glossario) for each MDC and over the years of analysis.
```{r, echo=FALSE, include=TRUE}
SDO_diurno %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(Accessi = sum(Accessi)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = Accessi,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "ACCESSI",
              subtitle = "Acuti - Regime diurno")


```

These bar charts shows the mean for the variable *Accessi* by each MDC and for the 4 years of analysis.

#### 2019 {-}
```{r, echo=FALSE, include=TRUE}
sum_accessi <- SDO_diurno %>%
  dplyr::filter(ANNO == "2019") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_accessi = max(`N. max. Accessi.`),
            MIN_accessi = min(`N. min. Accessi`),
            MEAN_accessi = round(mean(`N. medio Accessi`), digits = 3))

ggplot(data = sum_accessi, mapping = aes(x =    forcats::fct_reorder(CLASSE_MDC,                                                               MEAN_accessi), 
      y = MEAN_accessi)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER OGNI MDC",
              subtitle = "Acuti - Regime diurno",
       x = "CLASSE MDC",
       y = "Accessi") 
  

```


#### 2018 {-}
```{r, echo=FALSE, include=TRUE}
sum_accessi <- SDO_diurno %>%
  dplyr::filter(ANNO == "2018") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_accessi = max(`N. max. Accessi.`),
            MIN_accessi = min(`N. min. Accessi`),
            MEAN_accessi = round(mean(`N. medio Accessi`), digits = 3))

ggplot(data = sum_accessi, mapping = aes(x =    forcats::fct_reorder(CLASSE_MDC,                                                               MEAN_accessi), 
      y = MEAN_accessi)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER OGNI MDC",
              subtitle = "Acuti - Regime diurno",
       x = "CLASSE MDC",
       y = "Accessi") 
  

```



#### 2017 {-}
```{r, echo=FALSE, include=TRUE}
sum_accessi <- SDO_diurno %>%
  dplyr::filter(ANNO == "2017") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_accessi = max(`N. max. Accessi.`),
            MIN_accessi = min(`N. min. Accessi`),
            MEAN_accessi = round(mean(`N. medio Accessi`), digits = 3))

ggplot(data = sum_accessi, mapping = aes(x =    forcats::fct_reorder(CLASSE_MDC,                                                               MEAN_accessi), 
      y = MEAN_accessi)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER OGNI MDC",
              subtitle = "Acuti - Regime diurno",
       x = "CLASSE MDC",
       y = "Accessi") 
  

```


#### 2016 {-}
```{r, echo=FALSE, include=TRUE}
sum_accessi <- SDO_diurno %>%
  dplyr::filter(ANNO == "2016") %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_accessi = max(`N. max. Accessi.`),
            MIN_accessi = min(`N. min. Accessi`),
            MEAN_accessi = round(mean(`N. medio Accessi`), digits = 3))

ggplot(data = sum_accessi, mapping = aes(x =    forcats::fct_reorder(CLASSE_MDC,                                                               MEAN_accessi), 
      y = MEAN_accessi)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER OGNI MDC",
              subtitle = "Acuti - Regime diurno",
       x = "CLASSE MDC",
       y = "Accessi") 
  


```




### {-}

Table 1.2.3 provides a summary of Max, Min and Mean values for *"Accessi"* for each MDC.
```{r, echo=FALSE, include=TRUE}

SDO_diurno %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>% 
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
  dplyr::summarise(MAX_accessi = max(`N. max. Accessi.`),
            MIN_accessi = min(`N. min. Accessi`),
            MEAN_accessi = round(mean(`N. medio Accessi`), digits = 3)) %>% 
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.2.3'
    
  )
```


## Riabilitazione - Regime ordinario.

### DIMISSIONI

Table 1.3.1 provides a summary of the hospedalization discharges in *"Riabilitazione - Regime ordinario"* and the variation from year to year.

```{r, echo=FALSE, include=TRUE}
summary_ordinario_riab <- SDO_ordinario_riab %>% 
  dplyr::group_by(ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3))

summary_ordinario_riab %>% 
  DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 1.3.1')



```

This bar chart shows the hospital discharges by MDC for each year of the analysis.
```{r, echo=FALSE, include=TRUE}

SDO_ordinario_riab %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = DIMISSIONI,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER MDC",
              subtitle = "Riabilitazione - Regime ordinario")

  
```

There are just a few MDC classes with a considerable number of discharges in *Riabilitazione - Regime ordinario*. These are: **MDC 08 - Malattie e disturbi del sistema muscolo-scheletrico e del tessuto connettivo**; **MDC 01 - Malattie e disturbi del sistema nervoso**; **MDC 05 - Malattie e disturbi dell'apparato cardiocircolatorio**.


Table 1.3.2 provides a summary of the discharges for each MDC class and for each year.

```{r, echo=FALSE, include=TRUE}
#overall discharges for acuti - regime diurno for the 4 years
overall_riab_ord <- SDO_ordinario_riab %>%
  dplyr::select(CLASSE_MDC, DIMISSIONI, ANNO)

overall_riab_ord %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.3.2')
```


The bar chart below shows the distribution of discharges in *Riabilitazione - Regime ordinario* per age category, for each year of analysis.

```{r, echo=FALSE, include=TRUE}

sdo_age_gender2 <- sdo_age_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione - Regime ordinario") %>%
  dplyr::mutate_at(vars(`Categoria età`), factor)

sdo_age_gender2$`Categoria età` <- factor(sdo_age_gender2$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 9 anni",
                                            "Da 10 a 14 anni",
                                            "Da 15 a 19 anni",
                                            "Da 20 a 24 anni",
                                            "Da 25 a 29 anni", 
                                            "Da 30 a 34 anni", 
                                            "Da 35 a 39 anni",
                                            "Da 40 a 44 anni",
                                            "Da 45 a 49 anni", 
                                            "Da 50 a 54 anni", 
                                            "Da 55 a 59 anni", 
                                            "Da 60 a 64 anni", 
                                            "Da 65 a 69 anni", 
                                            "Da 70 a 74 anni",
                                            "75 anni e oltre"))
sdo_age_gender2 %>%
  dplyr::select(`Categoria età`, MASCHI, FEMMINE, ANNO) %>%
  dplyr::mutate(DIMISSIONI_TOT = MASCHI + FEMMINE) %>%
  dplyr::select(`Categoria età`, DIMISSIONI_TOT, ANNO) %>%
 
  ggplot(., aes(x = `Categoria età`,y = DIMISSIONI_TOT, fill = ANNO)) +
  geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5))

  

```


### GIORNATE DI DEGENZA {.tabset}

The following graph shows the *Giorni di Degenza* for each MDC and over the years of analysis.
```{r, echo=FALSE, include=TRUE}
SDO_ordinario_riab %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(GIORNI_DEGENZA = sum(`GIORNATE DI DEGENZA`)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = GIORNI_DEGENZA,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "GIORNI DI DEGENZA",
              subtitle = "Riabilitazione - Regime ordinario")


```


Table 1.3.3 provides a summary for *Giorni di Degenza* by MDC for each year.

```{r, echo=FALSE, include=TRUE}
overall_ordinario_degenza_riab <- SDO_ordinario_riab %>%
  dplyr::select(CLASSE_MDC, `GIORNATE DI DEGENZA`, ANNO)

overall_ordinario_degenza_riab %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 1.3.3"
                )

```



The following graph shows the Mean value for *Giorni di Degenza* for each MDC.

#### 2019 {-}
```{r, echo=FALSE, include=TRUE}

SDO_ordinario_riab %>%
  dplyr::filter(ANNO == "2019") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Riabilitazione - Regime ordinario",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  




```

#### 2018 {-}
```{r, echo=FALSE, include=TRUE}

SDO_ordinario_riab %>%
  dplyr::filter(ANNO == "2018") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Riabilitazione - Regime ordinario",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  




```

#### 2017 {-}
```{r, echo=FALSE, include=TRUE}

SDO_ordinario_riab %>%
  dplyr::filter(ANNO == "2017") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Riabilitazione - Regime ordinario",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  




```


#### 2016 {-}
```{r, echo=FALSE, include=TRUE}

SDO_ordinario_riab %>%
  dplyr::filter(ANNO == "2016") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Riabilitazione - Regime ordinario",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  




```

### {-}

Table 1.3.4 provides a summary for the mean value for *"Giorni di Degenza"* for each MDC.

```{r, echo=FALSE, include=TRUE}

SDO_ordinario_riab %>%
  dplyr::select(CLASSE_MDC, `DEGENZA MEDIA (giorni)`, ANNO) %>%
  mutate_at(vars(`DEGENZA MEDIA (giorni)`), funs(round), digits = 3) %>%
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.3.4'
    
  )
  


```


## Riabilitazione - Regime diurno.

### DIMISSIONI

Table 1.4.1 provides a summary of the hospedalization discharges in *"Riabilitazione - Regime diurno"* and the variation from year to year.

```{r, echo=FALSE, include=TRUE}
summary_diurno_riab <- SDO_diurno_riab %>% 
  dplyr::group_by(ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3))

summary_diurno_riab %>% 
  DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 1.4.1')


```



This bar chart shows the hospital discharges by MDC for each year of the analysis.
```{r, echo=FALSE, include=TRUE}

SDO_diurno_riab %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = DIMISSIONI,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER MDC",
              subtitle = "Riabilitazione - Regime diurno")

  
```

In the case of activity *Riabilitazione - Regime diurno*, there are a few MDC with a considerable level of discharges: **MDC 01 - Malattie e disturbi del sistema nervoso**;
**MDC 08 - Malattie e disturbi del sistema muscolo-scheletrico e del tessuto connettivo**; **MDC 23 - Fattori che influenzano lo stato di salute ed il ricorso ai servizi sanitari**.

The following table provides a summary of the discharges for each MDC class and for each year.

```{r, echo=FALSE, include=TRUE}
#overall discharges for acuti - regime diurno for the 4 years
overall_diurno_riab <- SDO_diurno_riab %>%
  dplyr::select(CLASSE_MDC, DIMISSIONI, ANNO)

overall_diurno_riab %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.4.2')
```


The bar chart below shows the distribution of discharges in *Riabilitazione - Regime diurno* per age category, for each year of analysis.

```{r, echo=FALSE, include=TRUE}

sdo_age_gender2 <- sdo_age_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione - Regime diurno") %>%
  dplyr::mutate_at(vars(`Categoria età`), factor)

sdo_age_gender2$`Categoria età` <- factor(sdo_age_gender2$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 9 anni",
                                            "Da 10 a 14 anni",
                                            "Da 15 a 19 anni",
                                            "Da 20 a 24 anni",
                                            "Da 25 a 29 anni", 
                                            "Da 30 a 34 anni", 
                                            "Da 35 a 39 anni",
                                            "Da 40 a 44 anni",
                                            "Da 45 a 49 anni", 
                                            "Da 50 a 54 anni", 
                                            "Da 55 a 59 anni", 
                                            "Da 60 a 64 anni", 
                                            "Da 65 a 69 anni", 
                                            "Da 70 a 74 anni",
                                            "75 anni e oltre"))
sdo_age_gender2 %>%
  dplyr::select(`Categoria età`, MASCHI, FEMMINE, ANNO) %>%
  dplyr::mutate(DIMISSIONI_TOT = MASCHI + FEMMINE) %>%
  dplyr::select(`Categoria età`, DIMISSIONI_TOT, ANNO) %>%
 
  ggplot(., aes(x = `Categoria età`,y = DIMISSIONI_TOT, fill = ANNO)) +
  geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5))

  

```


### ACCESSI {.tabset}

The following graph shows the *Accessi* for each MDC and over the years of analysis.
```{r, echo=FALSE, include=TRUE}
SDO_diurno_riab %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(Accessi = sum(ACCESSI)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = Accessi,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "ACCESSI",
              subtitle = "Riabilitazione - Regime diurno")


```


Table 1.4.3 provides a summary for *Accessi* by MDC for each year.

```{r, echo=FALSE, include=TRUE}
overall_diurno_accessi_riab <- SDO_diurno_riab %>%
  dplyr::select(CLASSE_MDC, ACCESSI, ANNO)

overall_diurno_accessi_riab %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 1.4.3"
                )

```



The following graph shows the Mean value for *Accessi* for each MDC.

#### 2019 {-}
```{r, echo=FALSE, include=TRUE}

SDO_diurno_riab %>%
  dplyr::filter(ANNO == "2019") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `NUMERO MEDIO DI ACCESSI`), 
                    y = `NUMERO MEDIO DI ACCESSI`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER MDC",
              subtitle = "Riabilitazione - Regime diurno",
       x = "CLASSE MDC",
       y = "ACCESSI") 
  




```

#### 2018 {-}
```{r, echo=FALSE, include=TRUE}

SDO_diurno_riab %>%
  dplyr::filter(ANNO == "2018") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `NUMERO MEDIO DI ACCESSI`), 
                    y = `NUMERO MEDIO DI ACCESSI`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER MDC",
              subtitle = "Riabilitazione - Regime diurno",
       x = "CLASSE MDC",
       y = "ACCESSI") 
  




```


#### 2017 {-}
```{r, echo=FALSE, include=TRUE}

SDO_diurno_riab %>%
  dplyr::filter(ANNO == "2017") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `NUMERO MEDIO DI ACCESSI`), 
                    y = `NUMERO MEDIO DI ACCESSI`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER MDC",
              subtitle = "Riabilitazione - Regime diurno",
       x = "CLASSE MDC",
       y = "ACCESSI") 
  




```



#### 2016 {-}
```{r, echo=FALSE, include=TRUE}

SDO_diurno_riab %>%
  dplyr::filter(ANNO == "2016") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `NUMERO MEDIO DI ACCESSI`), 
                    y = `NUMERO MEDIO DI ACCESSI`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "ACCESSI MEDI PER MDC",
              subtitle = "Riabilitazione - Regime diurno",
       x = "CLASSE MDC",
       y = "ACCESSI") 
  




```


### {-}


Table 1.4.4 provides a summary for the mean value for *Accessi* for each MDC.

```{r, echo=FALSE, include=TRUE}

SDO_diurno_riab %>%
  dplyr::select(CLASSE_MDC, `NUMERO MEDIO DI ACCESSI`, ANNO) %>%
  mutate_at(vars(`NUMERO MEDIO DI ACCESSI`), funs(round), digits = 3) %>%
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 4.4'
    
  )
  


```


## Lungodegenza.

### DIMISSIONI

Table 1.5.1 provides a summary of the hospedalization discharges in [*Lungodegenza*](#glossario) and the variation from year to year.

```{r, echo=FALSE, include=TRUE}
summary_lungodeg <- SDO_lungodegenza %>% 
  dplyr::group_by(ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate("VARIAZIONE %" = round((DIMISSIONI / lag(DIMISSIONI) -1) * 100, digits = 3))

summary_ordinario_riab %>% 
  DT::datatable( options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 5.1')



```

This bar chart shows the hospital discharges by MDC for each year of the analysis.
```{r, echo=FALSE, include=TRUE}

SDO_lungodegenza %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(DIMISSIONI = sum(DIMISSIONI)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = DIMISSIONI,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "DIMISSIONI PER MDC",
              subtitle = "Lungodegenza")

  
```

As shown from the bar chart, over the 4 years of analysis, the MDC class with the greatest number of dicharges for the activity *Lungodegenza* are: **MDC 08 - Malattie e disturbi del sistema muscolo-scheletrico e del tessuto connettivo**; **MDC 01 - Malattie e disturbi del sistema nervoso**; **MDC 04 - Malattie e disturbi dell'apparato respiratorio**.

The following table provides a summary of the discharges for each MDC class and for each year.

```{r, echo=FALSE, include=TRUE}
#overall discharges for acuti - regime diurno for the 4 years
overall_lungod <- SDO_lungodegenza %>%
  dplyr::select(CLASSE_MDC, DIMISSIONI, ANNO)

overall_lungod %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.5.2')
```

The bar chart below shows the distribution of discharges in *Lungodegenza* per age category, for each year of analysis.

```{r, echo=FALSE, include=TRUE}

sdo_age_gender2 <- sdo_age_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Lungodegenza") %>%
  dplyr::mutate_at(vars(`Categoria età`), factor)

sdo_age_gender2$`Categoria età` <- factor(sdo_age_gender2$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 9 anni",
                                            "Da 10 a 14 anni",
                                            "Da 15 a 19 anni",
                                            "Da 20 a 24 anni",
                                            "Da 25 a 29 anni", 
                                            "Da 30 a 34 anni", 
                                            "Da 35 a 39 anni",
                                            "Da 40 a 44 anni",
                                            "Da 45 a 49 anni", 
                                            "Da 50 a 54 anni", 
                                            "Da 55 a 59 anni", 
                                            "Da 60 a 64 anni", 
                                            "Da 65 a 69 anni", 
                                            "Da 70 a 74 anni",
                                            "75 anni e oltre"))
sdo_age_gender2 %>%
  dplyr::select(`Categoria età`, MASCHI, FEMMINE, ANNO) %>%
  dplyr::mutate(DIMISSIONI_TOT = MASCHI + FEMMINE) %>%
  dplyr::select(`Categoria età`, DIMISSIONI_TOT, ANNO) %>%
 
  ggplot(., aes(x = `Categoria età`,y = DIMISSIONI_TOT, fill = ANNO)) +
  geom_bar(stat = "identity", position = "dodge") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5))

  

```

### GIORNATE DI DEGENZA {.tabset}

The following graph shows the *Giorni di Degenza* for each MDC and over the years of analysis.
```{r, echo=FALSE, include=TRUE}
SDO_lungodegenza %>%
  dplyr::group_by(CLASSE_MDC, ANNO) %>%
  dplyr::summarise(GIORNI_DEGENZA = sum(`GIORNATE DI DEGENZA`)) %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  ggplot(.) +
  geom_bar(
    mapping = aes(y = GIORNI_DEGENZA,
                  x = CLASSE_MDC,
                  fill = ANNO),
    position = "dodge",
    width = .5,
           stat = "identity", 
           color = "black") + 
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "GIORNI DI DEGENZA",
              subtitle = "Lungodegenza")


```


Table 1.5.3 provides a summary for *Giorni di Degenza* by MDC for each year.

```{r, echo=FALSE, include=TRUE}
overall_lungod <- SDO_lungodegenza %>%
  dplyr::select(CLASSE_MDC, `GIORNATE DI DEGENZA`, ANNO)

overall_lungod %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 1.5.3"
                )

```



The following graph shows the Mean value for *Giorni di Degenza* for each MDC.

#### 2019 {-}
```{r, echo=FALSE, include=TRUE}

SDO_lungodegenza %>%
  dplyr::filter(ANNO == "2019") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Lungodegenza",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  




```

#### 2018 {-}
```{r, echo=FALSE, include=TRUE}

SDO_lungodegenza %>%
  dplyr::filter(ANNO == "2018") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Lungodegenza",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  




```

#### 2017 {-}
```{r, echo=FALSE, include=TRUE}

SDO_lungodegenza %>%
  dplyr::filter(ANNO == "2017") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Lungodegenza",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  




```


#### 2016 {-}
```{r, echo=FALSE, include=TRUE}

SDO_lungodegenza %>%
  dplyr::filter(ANNO == "2016") %>%
  dplyr::mutate(CLASSE_MDC = gsub("-.*", " ", CLASSE_MDC)) %>%
  dplyr::mutate(CLASSE_MDC = ifelse(stringr::str_detect(string = CLASSE_MDC,
                                                        pattern = "0|1|2"), 
                                    paste0("MDC ", CLASSE_MDC), CLASSE_MDC)) %>%
  dplyr::mutate_at(vars(ANNO, CLASSE_MDC), factor) %>%
ggplot(mapping = aes(x = forcats::fct_reorder(CLASSE_MDC, 
                                              `DEGENZA MEDIA (giorni)`), 
                    y = `DEGENZA MEDIA (giorni)`)) +
 geom_bar(stat = "identity") + 
  coord_flip() + 
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +  
  labs(title = "DEGENZA MEDIA PER OGNI MDC",
              subtitle = "Lungodegenza",
       x = "CLASSE MDC",
       y = "GIORNI DI DEGENZA") 
  




```

### {-}

Table 1.5.4 provides a summary for the mean value for *"Giorni di Degenza"* for each MDC.

```{r, echo=FALSE, include=TRUE}

SDO_lungodegenza %>%
  dplyr::select(CLASSE_MDC, `DEGENZA MEDIA (giorni)`, ANNO) %>%
  mutate_at(vars(`DEGENZA MEDIA (giorni)`), funs(round), digits = 3) %>%
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
    caption = 'Table 1.5.4'
    
  )
  


```



# TASSI DI OSPEDALIZZAZIONE 

## Overview in Italia

### TASSO DI OSPEDALIZZAZIONE IN ITALIA PER ATTIVITÀ
The following bar chart shows the evolution of the [*Tasso di ospedalizzazione*](#glossario) in Italy in the period of analysis.
As shown by the graph, there has been a decrease in the hospitalization rates per 1000 inhabitants, in particular for the activity *"Acuti - Regime ordinario"* (from 101.624 in 2016 to 97.611 in 2019).
```{r, echo=FALSE, include=TRUE}
HR_summary_act <- HR_age %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITALIA") %>%
  dplyr::group_by(ANNO, `ATTIVITÀ`) %>%
  dplyr::mutate(`ATTIVITÀ` = stringr::str_remove_all(string = `ATTIVITÀ`,
                                                     pattern = "Regime")) %>%
  dplyr::select(`Tasso complessivo`, ANNO, `ATTIVITÀ`) 

  ggplot(data = HR_summary_act, 
         mapping = aes(x = `ATTIVITÀ`, 
                       y = `Tasso complessivo` ,
                       fill = ANNO)) +
  geom_bar(position = "dodge",
           width = .5,
           stat = "identity", 
           color = "black") + 
  coord_flip() +
  theme(axis.text.x  = element_text(angle = 90, 
                                     hjust = 1, 
                                    vjust = 0.5)) + 
   labs(title = "TASSO DI OSPEDALIZZAZIONE (per 1000 abitanti)",
              subtitle = "ITALIA")
  
```

Table 2.1.1 provides an overview on the Hospitalization rates (per 1000 inhabitants) in Italy during the period 2016-2019.

```{r, echo=FALSE, include=TRUE}

HR_age %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITALIA") %>%
  dplyr::rename(`Tasso complessivo Italia` = "Tasso complessivo") %>%
  dplyr::select(`ATTIVITÀ`, `Tasso complessivo Italia`, ANNO) %>%
  dplyr::mutate_at(vars(`Tasso complessivo Italia`), funs(round), digits = 3) %>%
  
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 2.1"
  )

```

### TASSI DI OSPEDALIZZAZIONE PER GENERE

The graph below shows the hospitalization rates in Italy per gender and for the different activities. In this case, there has been a small reduction for both gender and for all the activities

```{r, echo=FALSE, include=TRUE}
gender_OR <- HR_gender %>%
  dplyr::group_by(ANNO, `ATTIVITÀ`) 


                                          
# reshape the dataframe in order to plot.

male <- gender_OR %>%
  dplyr::select(1, 2, 4, 5) %>%
  dplyr::rename(TASSO = "MASCHI") %>%
  dplyr::mutate(GENERE = "MASCHI") 

female <- gender_OR %>%
  dplyr::select(1,3, 4, 5) %>%
  dplyr::rename(TASSO = "FEMMINE") %>%
  dplyr::mutate(GENERE = "FEMMINE") 


Gend_HR_total <- dplyr::bind_rows(male, female) %>%
  dplyr::mutate_at(vars(TASSO), as.numeric)

Italy_HR <- Gend_HR_total %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITALIA") %>%
  dplyr::rename(tasso_it = "TASSO") %>%
  dplyr::mutate(`ATTIVITÀ` = stringr::str_remove_all(string = `ATTIVITÀ`,
                                                     pattern = "Regime")) 
  
  ggplot( data = Italy_HR, 
          aes(x =`ATTIVITÀ`, y = tasso_it, fill = GENERE)) +
  geom_bar(
    stat = "identity",
    position = "dodge"
    ) +
    coord_flip() +
   theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "TASSO DI OSPEDALIZZAZIONE (per genere, per 1000 abitanti)",
              subtitle = "Italia") +
    ylab(" ") + 
  facet_wrap(~ANNO)
  


```

Table 2.1.2 provides a summary for the data about hospitalization rates by gender in Italy.
```{r, echo=FALSE, include=TRUE}

Gend_HR_total %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITALIA") %>%
  dplyr::rename(tasso_it = "TASSO") %>%
  dplyr::select(-1) %>%
  dplyr::mutate_at(vars(tasso_it), round, digits = 3) %>%
  dplyr::rename(`Tasso ospedalizzazione` = "tasso_it") %>%
  
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 2.1.2"
  )


```

### TASSO DI OSPEDALIZZAZIONE PER CATEGORIA DI ETÀ ED ATTIVITÀ

The following graph represents the evolution of the hospitalization rates by age category in Italy and for each activity.
```{r, echo=FALSE, include=TRUE}

convert_HR_age <- function(activity){
  
  HR_summary_it <- HR_age_cat %>%
    dplyr::select(`Categoria età`, activity, ANNO) %>%
    dplyr::rename(TASSO = activity) %>%
    dplyr::mutate(`ATTIVITÀ` = activity) %>%
    dplyr::slice(-n())
  HR_summary_it$`Categoria età` <- factor(HR_summary_it$`Categoria età`,
                                      c("Meno di 1 anno",
                                        "Da 1 a 4 anni",
                                        "Da 5 a 14 anni",
                                        "Da 15 a 24 anni",
                                        "Da 25 a 44 anni", 
                                        "Da 45 a 64 anni", 
                                        "Da 65 a 74 anni", 
                                        "75 anni e oltre"))
  return(HR_summary_it)
}

activity_list <- list("Acuti - Regime ordinario", "Acuti - Regime diurno",
                      "Riabilitazione - Regime ordinario", 
                      "Riabilitazione - Regime diurno",
                      "Lungodegenza")

list_HR_age <- purrr::pmap(list(activity_list), convert_HR_age)

HR_age_it <- dplyr::bind_rows(list_HR_age) %>%
  dplyr::filter(!is.na(`Categoria età`)) %>%
  dplyr::group_by(ANNO, `ATTIVITÀ`) 

  ggplot(data = HR_age_it, aes(x = `Categoria età`,
                                   y = `TASSO`,
                                   fill = `ATTIVITÀ`,
                                   )) +
  geom_bar(stat = "identity",
           position = "dodge") +
    theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "TASSO DI OSPEDALIZZAZIONE (PER ETÀ, per 1000 abitanti)",
              subtitle = "Italia") +
    ylab(" ") + 
  facet_wrap(~ANNO)
  
     

```

Table 2.1.3 provides the summary for the hospitalization rates in Italy by age category. 
```{r, echo=FALSE, include=TRUE}

HR_age_it <- dplyr::bind_rows(list_HR_age) %>%
  dplyr::filter(!is.na(`Categoria età`)) %>%
  dplyr::mutate_at(vars(TASSO), round, digits = 3)

HR_age_it %>%
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 2.1.3"
  )

```


## Acuti - Regime ordinario

Table 2.2.1 shows the hospitalization rates for the activity *Acuti - Regime ordinario* for the 4 years of analysis and the corresponding percentage variation.

```{r, echo=FALSE, include=TRUE}
HR_summary_act %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti -  ordinario") %>%
  dplyr::mutate(`ATTIVITÀ` = "Acuti - Regime ordinario") %>%  
  dplyr::rename(TASSO = "Tasso complessivo") %>%
  ungroup() %>%
  dplyr::mutate("VARIAZIONE %" = round((TASSO / lag(TASSO) -1) * 100, 
                                       digits   = 3)) %>%
  DT::datatable(
    options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 2.2.1')
  

```


### TASSO PER CATEGORIE DI ETÀ
As shown by the graph, through the years of analysis the hospitalization rates by age category remained stable for the activity *Acuti - Regime ordinario*.

```{r, echo=FALSE, include=TRUE}

HR_summary <- HR_age_cat %>%
  dplyr::filter(`Categoria età` != "TOTALE") %>%
  dplyr::select(`Categoria età`, `Acuti - Regime ordinario`, ANNO) %>%
  dplyr::group_by(ANNO) 
  
HR_summary$`Categoria età` <- factor(HR_summary$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 14 anni",
                                            "Da 15 a 24 anni",
                                            "Da 25 a 44 anni", 
                                            "Da 45 a 64 anni", 
                                            "Da 65 a 74 anni", 
                                            "75 anni e oltre"))

  ggplot(data = HR_summary,
         aes(x = `Categoria età`, y = `Acuti - Regime ordinario`, fill = ANNO)) +
  geom_bar( stat = "identity",
            position = "dodge") +
     theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "TASSO DI OSPEDALIZZAZIONE (per età, per 1000 abitanti)",
              subtitle = "Acuti - Regime ordinario") +
    ylab(" ")


```



Table 2.2.2 represents the data for age category in *Acuti - Regime ordinario* for each year.


```{r, echo=FALSE, include=TRUE}

HR_summary %>%
  dplyr::rename(`Tasso di ospedalizz. (per 1000 ab.)` = "Acuti - Regime ordinario") %>%
  dplyr::mutate_at(vars(`Tasso di ospedalizz. (per 1000 ab.)`), round, digits = 3) %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 2.2.2"
                )

  

```


### TASSO PER REGIONE E SESSO

The following graphs show the evolution of the hospitalization rate in Italy by region and gender in the period 2016-2019. The horizontal blue line displays the hospitalization rates in all Italy for the male gender, the red one for the female gender.

```{r, echo=FALSE, include=TRUE}

gender_OR <- HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti - Regime ordinario") %>%
  dplyr::group_by(ANNO) 

gender_OR$`REGIONE DI RESIDENZA` <- rep(c("Pie", "VdA", "Lom", "Blz", "Trn", "Ven",
                                      "FVG", "Lig", "EmR", "Tos", "Umb", "Mar",
                                      "Laz", "Abr", "Mol", "Cam", "Pug", "Bas",
                                      "Cal", "Sic", "Sar", "ITA"),4
                                      )
gender_OR$`REGIONE DI RESIDENZA` <- factor(gender_OR$`REGIONE DI RESIDENZA`,
                                          c( "Pie", "VdA", "Lom", "Blz",
                                             "Trn", "Ven", "FVG", "Lig", 
                                             "EmR", "Tos", "Umb", "Mar",      
                                             "Laz", "Abr", "Mol", "Cam", 
                                             "Pug", "Bas","Cal", "Sic",
                                             "Sar", "ITA")
                                          )
# reshape the dataframe in order to plot.

male <- gender_OR %>%
  dplyr::select(1, 2, 5) %>%
  dplyr::rename(TASSO = "MASCHI") %>%
  dplyr::mutate(GENERE = "MASCHI") 

female <- gender_OR %>%
  dplyr::select(1,3,5) %>%
  dplyr::rename(TASSO = "FEMMINE") %>%
  dplyr::mutate(GENERE = "FEMMINE") 


Gend_HR_total <- dplyr::bind_rows(male, female) %>%
  dplyr::mutate_at(vars(TASSO), as.numeric)

Italy_HR <- Gend_HR_total %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITA") %>%
  dplyr::rename(tasso_it = "TASSO")

Gend_HR_without_ita <- Gend_HR_total %>%
  filter(`REGIONE DI RESIDENZA` != "ITA")


p <- ggplot(data = Gend_HR_without_ita, aes( x = `REGIONE DI RESIDENZA`, 
                                 y = TASSO,
                                 fill = GENERE)) + 
  geom_bar(stat = "identity",
           position = "dodge") + 
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "MASCHI"), aes(yintercept = tasso_it), 
             color = "blue") +
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "FEMMINE"), aes(yintercept = tasso_it), 
             color = "red") +
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +

  facet_wrap(~ANNO) +
  labs(
    title = "Tasso di ospedalizzazione per regione e sesso (per 1000 abitanti)",
    subtitle = "Acuti - Regime ordinario"
  )
p 


```


Table 2.2.3 shows the hospitalization rate for each region, by gender and year, for the activity *Acuti - Regime ordinario*.


```{r, echo=FALSE, include=TRUE}

HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti - Regime ordinario") %>%
  dplyr::group_by(ANNO)  %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), as.numeric) %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), round, digits = 3) %>% 
  dplyr::rename(`Tasso osp. Maschi` = "MASCHI",
                `Tasso osp. Femmine` = "FEMMINE") %>%
  dplyr::select(1:3, 5) %>%
  
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 2.2.3"
  )

```


## Acuti - Regime diurno

Table 3.1.1 shows the hospitalization rates for the activity *Acuti - Regime diurno* for the 4 years of analysis and the corresponding percentage variation.

```{r, echo=FALSE, include=TRUE}
HR_summary_act %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti -  diurno") %>%
  dplyr::mutate(`ATTIVITÀ` = "Acuti - Regime diurno") %>%  
  dplyr::rename(TASSO = "Tasso complessivo") %>%
  ungroup() %>%
  dplyr::mutate("VARIAZIONE %" = round((TASSO / lag(TASSO) -1) * 100, 
                                       digits   = 3)) %>%
  DT::datatable(
    options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 3.1.1')
  

```

### TASSO PER CATEGORIE DI ETÀ
The graph below shows that through the years of analysis the hospitalization rates by age category is decreased for all the age categories for the activity *Acuti - Regime diurno*.

```{r, echo=FALSE, include=TRUE}

HR_summary <- HR_age_cat %>%
  dplyr::filter(`Categoria età` != "TOTALE") %>%
  dplyr::select(`Categoria età`, `Acuti - Regime diurno`, ANNO) %>%
  dplyr::group_by(ANNO) 
  
HR_summary$`Categoria età` <- factor(HR_summary$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 14 anni",
                                            "Da 15 a 24 anni",
                                            "Da 25 a 44 anni", 
                                            "Da 45 a 64 anni", 
                                            "Da 65 a 74 anni", 
                                            "75 anni e oltre"))

  ggplot(data = HR_summary,
         aes(x = `Categoria età`, y = `Acuti - Regime diurno`, fill = ANNO)) +
  geom_bar( stat = "identity",
            position = "dodge") +
     theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "TASSO DI OSPEDALIZZAZIONE (per età, per 1000 abitanti)",
              subtitle = "Acuti - Regime diurno") +
    ylab(" ")


```


Table 3.1.2 represents the data for age category in *Acuti - Regime diurno* for each year.


```{r, echo=FALSE, include=TRUE}

HR_summary %>%
  dplyr::rename(`Tasso di ospedalizz. (per 1000 ab.)` = "Acuti - Regime diurno") %>%
  dplyr::mutate_at(vars(`Tasso di ospedalizz. (per 1000 ab.)`), round, digits = 3) %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 3.1.2"
                )

  

```


### TASSO PER REGIONE E SESSO

The following graphs show the evolution of the hospitalization rate in Italy by region and gender in the period 2016-2019. The horizontal blue line displays the hospitalization rates in Italy for the male gender, the red one for the female gender.

```{r, echo=FALSE, include=TRUE}

gender_OR <- HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti - Regime diurno") %>%
  dplyr::group_by(ANNO) 

gender_OR$`REGIONE DI RESIDENZA` <- rep(c("Pie", "VdA", "Lom", "Blz", "Trn", "Ven",
                                      "FVG", "Lig", "EmR", "Tos", "Umb", "Mar",
                                      "Laz", "Abr", "Mol", "Cam", "Pug", "Bas",
                                      "Cal", "Sic", "Sar", "ITA"),4
                                      )
gender_OR$`REGIONE DI RESIDENZA` <- factor(gender_OR$`REGIONE DI RESIDENZA`,
                                          c( "Pie", "VdA", "Lom", "Blz",
                                             "Trn", "Ven", "FVG", "Lig", 
                                             "EmR", "Tos", "Umb", "Mar",      
                                             "Laz", "Abr", "Mol", "Cam", 
                                             "Pug", "Bas","Cal", "Sic",
                                             "Sar", "ITA")
                                          )
# reshape the dataframe in order to plot.

male <- gender_OR %>%
  dplyr::select(1, 2, 5) %>%
  dplyr::rename(TASSO = "MASCHI") %>%
  dplyr::mutate(GENERE = "MASCHI") 

female <- gender_OR %>%
  dplyr::select(1,3,5) %>%
  dplyr::rename(TASSO = "FEMMINE") %>%
  dplyr::mutate(GENERE = "FEMMINE") 


Gend_HR_total <- dplyr::bind_rows(male, female) %>%
  dplyr::mutate_at(vars(TASSO), as.numeric)

Italy_HR <- Gend_HR_total %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITA") %>%
  dplyr::rename(tasso_it = "TASSO")

Gend_HR_without_ita <- Gend_HR_total %>%
  filter(`REGIONE DI RESIDENZA` != "ITA")


p <- ggplot(data = Gend_HR_without_ita, aes( x = `REGIONE DI RESIDENZA`, 
                                 y = TASSO,
                                 fill = GENERE)) + 
  geom_bar(stat = "identity",
           position = "dodge") + 
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "MASCHI"), aes(yintercept = tasso_it), 
             color = "blue") +
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "FEMMINE"), aes(yintercept = tasso_it), 
             color = "red") +
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +

  facet_wrap(~ANNO) +
  labs(
    title = "Tasso di ospedalizzazione per regione e sesso (per 1000 abitanti)",
    subtitle = "Acuti - Regime diurno"
  )
p 


```


Table 3.1.3 shows the hospitalization rate for each region, by gender and year, for the activity *Acuti - Regime diurno*.


```{r, echo=FALSE, include=TRUE}

HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Acuti - Regime diurno") %>%
  dplyr::group_by(ANNO)  %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), as.numeric) %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), round, digits = 3) %>% 
  dplyr::rename(`Tasso osp. Maschi` = "MASCHI",
                `Tasso osp. Femmine` = "FEMMINE") %>%
  dplyr::select(1:3, 5) %>%
  
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 3.1.3"
  )

```





## Riabilitazione - Regime ordinario

Table 4.1.1 shows the hospitalization rates for the activity *Riabilitazione - Regime ordinario* for the 4 years of analysis and the corresponding percentage variation.

```{r, echo=FALSE, include=TRUE}
HR_summary_act %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione -  ordinario") %>%
  dplyr::mutate(`ATTIVITÀ` = "Riabilitazione - Regime ordinario") %>%  
  dplyr::rename(TASSO = "Tasso complessivo") %>%
  ungroup() %>%
  dplyr::mutate("VARIAZIONE %" = round((TASSO / lag(TASSO) -1) * 100, 
                                       digits   = 3)) %>%
  DT::datatable(
    options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 4.1.1')
  

```

### TASSO PER CATEGORIE DI ETÀ
As shown by the graph, through the years of analysis the hospitalization rates remained stable for some of the age categories, while decreased for others, in particular for the categories: *"Da 65 a 74 anni"* and *"75 anni e oltre"* for the activity *Riabilitazione - Regime ordinario*.

```{r, echo=FALSE, include=TRUE}

HR_summary <- HR_age_cat %>%
  dplyr::filter(`Categoria età` != "TOTALE") %>%
  dplyr::select(`Categoria età`, `Riabilitazione - Regime ordinario`, ANNO) %>%
  dplyr::group_by(ANNO) 
  
HR_summary$`Categoria età` <- factor(HR_summary$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 14 anni",
                                            "Da 15 a 24 anni",
                                            "Da 25 a 44 anni", 
                                            "Da 45 a 64 anni", 
                                            "Da 65 a 74 anni", 
                                            "75 anni e oltre"))

  ggplot(data = HR_summary,
         aes(x = `Categoria età`, 
             y = `Riabilitazione - Regime ordinario`,
             fill = ANNO)) +
  geom_bar( stat = "identity",
            position = "dodge") +
     theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "TASSO DI OSPEDALIZZAZIONE (per età, per 1000 abitanti)",
              subtitle = "Riabilitazione - Regime ordinario") +
    ylab(" ")


```


Table 4.1.2 represents the data for age category in *Riabilitazione - Regime ordinario* for each year.


```{r, echo=FALSE, include=TRUE}

HR_summary %>%
  dplyr::rename(`Tasso di ospedalizz. (per 1000 ab.)` = "Riabilitazione - Regime ordinario") %>%
  dplyr::mutate_at(vars(`Tasso di ospedalizz. (per 1000 ab.)`), round, digits = 3) %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 4.1.2"
                )

  

```


### TASSO PER REGIONE E SESSO

The following graphs show the evolution of the hospitalization rate in Italy by region and gender in the period 2016-2019. The horizontal blue line displays the hospitalization rates in Italy for the male gender, the red one for the female gender.

```{r, echo=FALSE, include=TRUE}

gender_OR <- HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione - Regime ordinario") %>%
  dplyr::group_by(ANNO) 

gender_OR$`REGIONE DI RESIDENZA` <- rep(c("Pie", "VdA", "Lom", "Blz", "Trn", "Ven",
                                      "FVG", "Lig", "EmR", "Tos", "Umb", "Mar",
                                      "Laz", "Abr", "Mol", "Cam", "Pug", "Bas",
                                      "Cal", "Sic", "Sar", "ITA"),4
                                      )
gender_OR$`REGIONE DI RESIDENZA` <- factor(gender_OR$`REGIONE DI RESIDENZA`,
                                          c( "Pie", "VdA", "Lom", "Blz",
                                             "Trn", "Ven", "FVG", "Lig", 
                                             "EmR", "Tos", "Umb", "Mar",      
                                             "Laz", "Abr", "Mol", "Cam", 
                                             "Pug", "Bas","Cal", "Sic",
                                             "Sar", "ITA")
                                          )
# reshape the dataframe in order to plot.

male <- gender_OR %>%
  dplyr::select(1, 2, 5) %>%
  dplyr::rename(TASSO = "MASCHI") %>%
  dplyr::mutate(GENERE = "MASCHI") 

female <- gender_OR %>%
  dplyr::select(1,3,5) %>%
  dplyr::rename(TASSO = "FEMMINE") %>%
  dplyr::mutate(GENERE = "FEMMINE") 


Gend_HR_total <- dplyr::bind_rows(male, female) %>%
  dplyr::mutate_at(vars(TASSO), as.numeric)

Italy_HR <- Gend_HR_total %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITA") %>%
  dplyr::rename(tasso_it = "TASSO")

Gend_HR_without_ita <- Gend_HR_total %>%
  filter(`REGIONE DI RESIDENZA` != "ITA")


p <- ggplot(data = Gend_HR_without_ita, aes( x = `REGIONE DI RESIDENZA`, 
                                 y = TASSO,
                                 fill = GENERE)) + 
  geom_bar(stat = "identity",
           position = "dodge") + 
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "MASCHI"), aes(yintercept = tasso_it), 
             color = "blue") +
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "FEMMINE"), aes(yintercept = tasso_it), 
             color = "red") +
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +

  facet_wrap(~ANNO) +
  labs(
    title = "Tasso di ospedalizzazione per regione e sesso (per 1000 abitanti)",
    subtitle = "Riabilitazione - Regime ordinario"
  )
p 


```


Table 4.1.3 shows the hospitalization rate for each region, by gender and year, for the activity *Riabilitazione - Regime ordinario*.


```{r, echo=FALSE, include=TRUE}

HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione - Regime ordinario") %>%
  dplyr::group_by(ANNO)  %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), as.numeric) %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), round, digits = 3) %>% 
  dplyr::rename(`Tasso osp. Maschi` = "MASCHI",
                `Tasso osp. Femmine` = "FEMMINE") %>%
  dplyr::select(1:3, 5) %>%
  
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 4.1.3"
  )

```


## Riabilitazione - Regime diurno

Table 5.1.1 shows the hospitalization rates for the activity *Riabilitazione - Regime diurno* for the 4 years of analysis and the corresponding percentage variation.

```{r, echo=FALSE, include=TRUE}
HR_summary_act %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione -  diurno") %>%
  dplyr::mutate(`ATTIVITÀ` = "Riabilitazione - Regime diurno") %>%  
  dplyr::rename(TASSO = "Tasso complessivo") %>%
  ungroup() %>%
  dplyr::mutate("VARIAZIONE %" = round((TASSO / lag(TASSO) -1) * 100, 
                                       digits   = 3)) %>%
  DT::datatable(
    options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 5.1.1')
  

```

### TASSO PER CATEGORIE DI ETÀ
As shown by the graph, through the years of analysis the hospitalization rates is increased for some of the age categories (*"Da 1 a 4 anni"* and *"Da 5 a 14 anni"*) and is decreased for some others (*"Da 45 a 64 anni"*; *"Da 65 a 74 anni"* and *"75 anni e oltre"* ) remained stable for the activity *Riabilitazione - Regime diurno*.

```{r, echo=FALSE, include=TRUE}

HR_summary <- HR_age_cat %>%
  dplyr::filter(`Categoria età` != "TOTALE") %>%
  dplyr::select(`Categoria età`, `Riabilitazione - Regime diurno`, ANNO) %>%
  dplyr::group_by(ANNO) 
  
HR_summary$`Categoria età` <- factor(HR_summary$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 14 anni",
                                            "Da 15 a 24 anni",
                                            "Da 25 a 44 anni", 
                                            "Da 45 a 64 anni", 
                                            "Da 65 a 74 anni", 
                                            "75 anni e oltre"))

  ggplot(data = HR_summary,
         aes(x = `Categoria età`, 
             y = `Riabilitazione - Regime diurno`,
             fill = ANNO)) +
  geom_bar( stat = "identity",
            position = "dodge") +
     theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "TASSO DI OSPEDALIZZAZIONE (per età, per 1000 abitanti)",
              subtitle = "Riabilitazione - Regime diurno") +
    ylab(" ")


```


Table 5.1.2 represents the data for age category in *Riabilitazione - Regime diurno* for each year.


```{r, echo=FALSE, include=TRUE}

HR_summary %>%
  dplyr::rename(`Tasso di ospedalizz. (per 1000 ab.)` = "Riabilitazione - Regime diurno") %>%
  dplyr::mutate_at(vars(`Tasso di ospedalizz. (per 1000 ab.)`), round, digits = 3) %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 5.1.2"
                )

  

```


### TASSO PER REGIONE E SESSO 

The following graphs show the evolution of the hospitalization rate in Italy by region and gender in the period 2016-2019. The horizontal blue line displays the hospitalization rates in Italy for the male gender, the red one for the female gender.
 
```{r, echo=FALSE, include=TRUE}

gender_OR <- HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione - Regime diurno") %>%
  dplyr::group_by(ANNO) 

gender_OR$`REGIONE DI RESIDENZA` <- rep(c("Pie", "VdA", "Lom", "Blz", "Trn", "Ven",
                                      "FVG", "Lig", "EmR", "Tos", "Umb", "Mar",
                                      "Laz", "Abr", "Mol", "Cam", "Pug", "Bas",
                                      "Cal", "Sic", "Sar", "ITA"),4
                                      )
gender_OR$`REGIONE DI RESIDENZA` <- factor(gender_OR$`REGIONE DI RESIDENZA`,
                                          c( "Pie", "VdA", "Lom", "Blz",
                                             "Trn", "Ven", "FVG", "Lig", 
                                             "EmR", "Tos", "Umb", "Mar",      
                                             "Laz", "Abr", "Mol", "Cam", 
                                             "Pug", "Bas","Cal", "Sic",
                                             "Sar", "ITA")
                                          )
# reshape the dataframe in order to plot.

male <- gender_OR %>%
  dplyr::select(1, 2, 5) %>%
  dplyr::rename(TASSO = "MASCHI") %>%
  dplyr::mutate(GENERE = "MASCHI") 

female <- gender_OR %>%
  dplyr::select(1,3,5) %>%
  dplyr::rename(TASSO = "FEMMINE") %>%
  dplyr::mutate(GENERE = "FEMMINE") 


Gend_HR_total <- dplyr::bind_rows(male, female) %>%
  dplyr::mutate_at(vars(TASSO), as.numeric)

Italy_HR <- Gend_HR_total %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITA") %>%
  dplyr::rename(tasso_it = "TASSO")

Gend_HR_without_ita <- Gend_HR_total %>%
  filter(`REGIONE DI RESIDENZA` != "ITA")


p <- ggplot(data = Gend_HR_without_ita, aes( x = `REGIONE DI RESIDENZA`, 
                                 y = TASSO,
                                 fill = GENERE)) + 
  geom_bar(stat = "identity",
           position = "dodge") + 
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "MASCHI"), aes(yintercept = tasso_it), 
             color = "blue") +
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "FEMMINE"), aes(yintercept = tasso_it), 
             color = "red") +
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +

  facet_wrap(~ANNO) +
  labs(
    title = "Tasso di ospedalizzazione per regione e sesso (per 1000 abitanti)",
    subtitle = "Riabilitazione - Regime diurno"
  )
p 


```


Table 5.1.3 shows the hospitalization rate for each region, by gender and year, for the activity *Riabilitazione - Regime diurno*.


```{r, echo=FALSE, include=TRUE}

HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Riabilitazione - Regime diurno") %>%
  dplyr::group_by(ANNO)  %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), as.numeric) %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), round, digits = 3) %>% 
  dplyr::rename(`Tasso osp. Maschi` = "MASCHI",
                `Tasso osp. Femmine` = "FEMMINE") %>%
  dplyr::select(1:3, 5) %>%
  
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 5.1.3"
  )

```



## Lungodegenza

Table 6.1.1 shows the hospitalization rates for the activity *Lungodegenza* for the 4 years of analysis and the corresponding percentage variation.

```{r, echo=FALSE, include=TRUE}
HR_summary_act %>%
  dplyr::filter(`ATTIVITÀ` == "Lungodegenza") %>%
  dplyr::mutate(`ATTIVITÀ` = "Lungodegenza") %>%  
  dplyr::rename(TASSO = "Tasso complessivo") %>%
  ungroup() %>%
  dplyr::mutate("VARIAZIONE %" = round((TASSO / lag(TASSO) -1) * 100, 
                                       digits   = 3)) %>%
  DT::datatable(
    options = list(
    lengthChange = FALSE,
    paging = FALSE,
    searching = FALSE
    
  ),
    caption = 'Table 6.1.1')
  

```

### TASSO PER CATEGORIE DI ETÀ
The graph below shows that the hospitalization rate is almost 0 for the earlier age categories and is much higher for the last ones. Through the years of analysis the hospitalization rates decreased for these latter categories for the activity *Lungodegenza*.

```{r, echo=FALSE, include=TRUE}

HR_summary <- HR_age_cat %>%
  dplyr::filter(`Categoria età` != "TOTALE") %>%
  dplyr::select(`Categoria età`, `Lungodegenza`, ANNO) %>%
  dplyr::group_by(ANNO) 
  
HR_summary$`Categoria età` <- factor(HR_summary$`Categoria età`,
                                          c("Meno di 1 anno",
                                            "Da 1 a 4 anni",
                                            "Da 5 a 14 anni",
                                            "Da 15 a 24 anni",
                                            "Da 25 a 44 anni", 
                                            "Da 45 a 64 anni", 
                                            "Da 65 a 74 anni", 
                                            "75 anni e oltre"))

  ggplot(data = HR_summary,
         aes(x = `Categoria età`, 
             y = `Lungodegenza`,
             fill = ANNO)) +
  geom_bar( stat = "identity",
            position = "dodge") +
     theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) + 
  labs(title = "TASSO DI OSPEDALIZZAZIONE (per età, per 1000 abitanti)",
              subtitle = "Lungodegenza") +
    ylab(" ")


```


Table 6.1.2 represents the data for age category in *Lungodegenza* for each year.


```{r, echo=FALSE, include=TRUE}

HR_summary %>%
  dplyr::rename(`Tasso di ospedalizz. (per 1000 ab.)` = "Lungodegenza") %>%
  dplyr::mutate_at(vars(`Tasso di ospedalizz. (per 1000 ab.)`), round, digits = 3) %>%
  DT::datatable(extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 6.1.2"
                )

  

```


### TASSO PER REGIONE E SESSO

The following graphs show the evolution of the hospitalization rate in Italy by region and gender in the period 2016-2019. The horizontal blue line displays the hospitalization rates in Italy for the male gender, the red one for the female gender.

```{r, echo=FALSE, include=TRUE}

gender_OR <- HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Lungodegenza") %>%
  dplyr::group_by(ANNO) 

gender_OR$`REGIONE DI RESIDENZA` <- rep(c("Pie", "VdA", "Lom", "Blz", "Trn", "Ven",
                                      "FVG", "Lig", "EmR", "Tos", "Umb", "Mar",
                                      "Laz", "Abr", "Mol", "Cam", "Pug", "Bas",
                                      "Cal", "Sic", "Sar", "ITA"),4
                                      )
gender_OR$`REGIONE DI RESIDENZA` <- factor(gender_OR$`REGIONE DI RESIDENZA`,
                                          c( "Pie", "VdA", "Lom", "Blz",
                                             "Trn", "Ven", "FVG", "Lig", 
                                             "EmR", "Tos", "Umb", "Mar",      
                                             "Laz", "Abr", "Mol", "Cam", 
                                             "Pug", "Bas","Cal", "Sic",
                                             "Sar", "ITA")
                                          )
# reshape the dataframe in order to plot.

male <- gender_OR %>%
  dplyr::select(1, 2, 5) %>%
  dplyr::rename(TASSO = "MASCHI") %>%
  dplyr::mutate(GENERE = "MASCHI") 

female <- gender_OR %>%
  dplyr::select(1,3,5) %>%
  dplyr::rename(TASSO = "FEMMINE") %>%
  dplyr::mutate(GENERE = "FEMMINE") 


Gend_HR_total <- dplyr::bind_rows(male, female) %>%
  dplyr::mutate_at(vars(TASSO), as.numeric)

Italy_HR <- Gend_HR_total %>%
  dplyr::filter(`REGIONE DI RESIDENZA` == "ITA") %>%
  dplyr::rename(tasso_it = "TASSO")

Gend_HR_without_ita <- Gend_HR_total %>%
  filter(`REGIONE DI RESIDENZA` != "ITA")


p <- ggplot(data = Gend_HR_without_ita, aes( x = `REGIONE DI RESIDENZA`, 
                                 y = TASSO,
                                 fill = GENERE)) + 
  geom_bar(stat = "identity",
           position = "dodge") + 
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "MASCHI"), aes(yintercept = tasso_it), 
             color = "blue") +
  geom_hline(data = Italy_HR %>% 
               filter(GENERE == "FEMMINE"), aes(yintercept = tasso_it), 
             color = "red") +
  theme(axis.text.x  = element_text(angle = 90, 
                                    hjust = 1, 
                                    vjust = 0.5)) +

  facet_wrap(~ANNO) +
  labs(
    title = "Tasso di ospedalizzazione per regione e sesso (per 1000 abitanti)",
    subtitle = "Lungodegenza"
  )
p 


```


Table 6.1.3 shows the hospitalization rate for each region, by gender and year, for the activity *Lungodegenza*.


```{r, echo=FALSE, include=TRUE}

HR_gender %>%
  dplyr::filter(`ATTIVITÀ` == "Lungodegenza") %>%
  dplyr::group_by(ANNO)  %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), as.numeric) %>%
  dplyr::mutate_at(vars(MASCHI, FEMMINE), round, digits = 3) %>% 
  dplyr::rename(`Tasso osp. Maschi` = "MASCHI",
                `Tasso osp. Femmine` = "FEMMINE") %>%
  dplyr::select(1:3, 5) %>%
  
  DT::datatable(
    extensions = 'Buttons', 
                options = list(dom = 'Bfrtip',
                               buttons = c('excel', "csv")
                               ),
                caption = "Table 6.1.3"
  )

```




\pagebreak

# GLOSSARIO {-}

**MDC**: MAJOR DIAGNOSTIC CATEGORY (MDC)
Categoria diagnostica principale: il sistema DRG prevede un livello superiore di raggruppamento basato su un criterio di rilevanza clinica (anatomico o eziologico): in base alla diagnosi principale riportata nella Scheda di Dimissione Ospedaliera viene assegnata la categoria MDC; successivamente, viene attribuito uno specifico DRG fra quelli appartenenti alla MDC selezionata. 

**Giorno di Degenza**: Periodo di 24 ore durante il quale un posto letto è occupato.  

**Accessi**: Presenza in ospedale senza pernottamento, per l’erogazione di prestazioni in regime di day hospital.

**Ricoveri di Lungodegenza**: Sono i ricoveri di pazienti dimessi da reparti appartenenti alla disciplina LUNGODEGENTI (codice 60 nei
modelli di rilevazione del Sistema informativo sanitario). 

**Tasso di ospedalizzazione**: Il tasso di ospedalizzazione fornisce una
misura sintetica sul ricorso al ricovero ospedaliero della popolazione oggetto di studio. Si calcola come rapporto fra numero di ricoveri ospedalieri, ovunque
effettuati, relativi a soggetti residenti in una data regione e la complessiva popolazione ivi residente
